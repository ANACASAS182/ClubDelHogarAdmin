"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[667],{667:(Me,x,c)=>{c.r(x),c.d(x,{ReferenciasPageModule:()=>Be});var g=c(2881),p=c(9417),s=c(3092),j=c(9870),C=c(467),S=c(7550),b=c(2042),d=c(3662),E=c(1413),_=c(4843),I=c(152),O=c(3294),U=c(6977),y=c(7786),D=c(9172),T=c(5558),P=c(9437),$=c(7673),B=c(6354),R=function(i){return i[i.Creado=1]="Creado",i[i.Seguimiento=2]="Seguimiento",i[i.Cerrado=3]="Cerrado",i}(R||{});const V={Creado:"Creado",Seguimiento:"Seguimiento",Cerrado:"Cerrado"};function G(){return Object.keys(R).filter(i=>isNaN(Number(i))).map(i=>({nombre:V[i],valor:R[i]}))}var v=c(6231),e=c(1360);const X=["class","qr view"];function Y(i,r){if(1&i&&e.nrm(0,"img",8),2&i){const o=e.XpG();e.Y8G("src",o.imagenBase64,e.B4B)}}let A=(()=>{var i;class r{constructor(t){this.modalCtrl=t,this.imagenBase64=""}ngOnInit(){}close(){this.modalCtrl.dismiss()}}return(i=r).\u0275fac=function(t){return new(t||i)(e.rXU(s.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-modal",8,"qr","view"]],inputs:{imagenBase64:"imagenBase64"},attrs:X,decls:10,vars:2,consts:[[1,"modalHeader"],["slot","end"],[3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[1,"modalform-title","ion-text-center"],[1,"upload-card"],[3,"src",4,"ngIf"],[3,"src"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",0)(1,"ion-buttons",1)(2,"ion-button",2),e.bIt("click",function(){return n.close()}),e.nrm(3,"ion-icon",3),e.k0s()()(),e.j41(4,"ion-content",4)(5,"h2",5),e.EFF(6," QR"),e.k0s(),e.j41(7,"ion-item")(8,"ion-card",6),e.DNE(9,Y,1,1,"img",7),e.k0s()()()),2&t&&(e.R7$(4),e.Y8G("fullscreen",!1),e.R7$(5),e.Y8G("ngIf",n.imagenBase64))},dependencies:[s.bv,s.Jm,s.QW,s.b_,s.W9,s.eU,s.iq,s.uz,p.X1,g.MD,g.bT],encapsulation:2}),r})();var M=c(980),z=c(5460),Q=c(6152),h=c(7643),k=c(5312);let N=(()=>{var i;class r{constructor(t){this.http=t,this.apiUrl=k.c.apiUrl+"api/Referido"}getAllReferidosPaginated(t){let n=(new h.Nl).set("page",t.page.toString()).set("size",t.size.toString()).set("sortBy",t.sortBy).set("sortDir",t.sortDir).set("searchQuery",t.searchQuery||"").set("empresaID",t.empresaID.toString()).set("grupoID",t.grupoID.toString()).set("usuarioID",t.usuarioID.toString());return null!=t.statusEnum&&(n=n.set("estatus",t.statusEnum.toString())),this.http.get(`${this.apiUrl}/GetAllReferidosPaginated`,{params:n})}getReferidosByEmpresaPaginated(t){let n=(new h.Nl).set("empresaID",t.id.toString()).set("page",t.page.toString()).set("size",t.size.toString()).set("sortBy",t.sortBy).set("sortDir",t.sortDir).set("usuarioID",t.usuarioID.toString()).set("searchQuery",t.searchQuery||"");return null!=t.statusEnum&&(n=n.set("estatus",t.statusEnum.toString())),this.http.get(`${this.apiUrl}/GetReferidosByEmpresaPaginated`,{params:n})}getByID(t){let n=(new h.Nl).set("id",t);return this.http.get(`${this.apiUrl}/GetReferidoByID`,{params:n})}updateEstatus(t){return this.http.post(`${this.apiUrl}/UpdateStatus`,t)}getQR(t){let n=(new h.Nl).set("codigo",t);return this.http.get(`${this.apiUrl}/GetQR`,{params:n})}}return(i=r).\u0275fac=function(t){return new(t||i)(e.KVO(h.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),r})(),W=(()=>{var i;class r{constructor(t){this.http=t,this.apiUrl=k.c.apiUrl+"api/SeguimientoReferido"}getSeguimientosReferido(t){let n=(new h.Nl).set("referidoID",t);return this.http.get(`${this.apiUrl}/GetSeguimientoReferido`,{params:n})}save(t){return this.http.post(`${this.apiUrl}/Save`,t)}}return(i=r).\u0275fac=function(t){return new(t||i)(e.KVO(h.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),r})();const H=["class","seguimiento referencia"],w=()=>({header:"Estatus de seguimiento"});function L(i,r){if(1&i&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&i){const o=r.$implicit,t=e.XpG();e.Y8G("value",o.valor)("disabled",t.isCreadoDisabled(o.valor)),e.R7$(),e.SpI(" ",o.nombre," ")}}function J(i,r){1&i&&(e.j41(0,"ion-text",20),e.EFF(1," Campo requerido "),e.k0s())}function K(i,r){if(1&i&&(e.j41(0,"ion-select-option",19),e.EFF(1),e.k0s()),2&i){const o=r.$implicit,t=e.XpG();e.Y8G("value",o.valor)("disabled",t.isCreadoDisabled(o.valor)),e.R7$(),e.SpI(" ",o.nombre," ")}}function Z(i,r){1&i&&(e.j41(0,"ion-text",20),e.EFF(1," Campo requerido "),e.k0s())}function q(i,r){1&i&&(e.j41(0,"ion-text",20),e.EFF(1," Campo requerido "),e.k0s())}function ee(i,r){if(1&i){const o=e.RV6();e.j41(0,"ion-card",7)(1,"ion-card-header")(2,"ion-card-title",8),e.EFF(3,"Agregar seguimiento"),e.k0s()(),e.j41(4,"ion-card-content")(5,"form",21),e.nrm(6,"ion-textarea",22),e.DNE(7,q,2,0,"ion-text",12),e.j41(8,"div",13)(9,"ion-button",14),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.enviarFormulario())}),e.EFF(10," Enviar seguimiento "),e.k0s()()()()()}if(2&i){let o,t;const n=e.XpG();e.R7$(5),e.Y8G("formGroup",n.formulario),e.R7$(),e.AVh("invalid",(null==(o=n.getControl("comentario"))?null:o.invalid)&&(null==(o=n.getControl("comentario"))?null:o.touched)),e.R7$(),e.Y8G("ngIf",(null==(t=n.getControl("comentario"))?null:t.invalid)&&(null==(t=n.getControl("comentario"))?null:t.touched)),e.R7$(2),e.Y8G("disabled",n.formEnviado)}}function te(i,r){if(1&i&&(e.j41(0,"div",25),e.nrm(1,"div",26),e.j41(2,"div",27)(3,"div",28),e.nrm(4,"ion-icon",29),e.j41(5,"span",30),e.EFF(6),e.k0s()(),e.j41(7,"div",31),e.EFF(8),e.k0s()()()),2&i){const o=r.$implicit,t=e.XpG(2);e.R7$(6),e.JRh(t.formatFecha(o.fechaSeguimiento)),e.R7$(2),e.JRh(o.comentario)}}function ne(i,r){if(1&i&&(e.j41(0,"div",23),e.DNE(1,te,9,2,"div",24),e.nI1(2,"slice"),e.k0s()),2&i){const o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.mostrarTodos?o.seguimientos:e.brH(2,2,o.seguimientos,0,5))("ngForTrackBy",o.trackByIndex)}}function ie(i,r){1&i&&(e.j41(0,"span",32),e.EFF(1,"A\xfan no hay seguimientos"),e.k0s())}function oe(i,r){if(1&i){const o=e.RV6();e.j41(0,"div",13)(1,"ion-button",33),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.mostrarTodos=!n.mostrarTodos)}),e.EFF(2),e.k0s()()}if(2&i){const o=e.XpG();e.R7$(2),e.SpI(" ",o.mostrarTodos?"Ver menos":"Ver todos"," ")}}let ae=(()=>{var i;class r{constructor(t,n,a,l,m,u){this.fb=t,this.modalCtrl=n,this.toastController=a,this.loadingCtrl=l,this.referidoService=m,this.seguimientoReferidoService=u,this.formEnviado=!1,this.numSeguimientos=0,this.seguimientos=[],this.estatus=G(),this.estatusReferenciaEnum=R,this.compareNum=(f,Ge)=>Number(f)===Number(Ge),this.mostrarTodos=!1,this.formulario=this.fb.group({comentario:["",[p.k0.required,(0,z.a)()]]}),this.formStatus=this.fb.group({status:["",p.k0.required]})}getEstatusActual(t){var n,a,l;const m=null!==(n=null!==(a=null!==(l=null==t?void 0:t.estatusReferenciaEnum)&&void 0!==l?l:null==t?void 0:t.estatusReferenciaID)&&void 0!==a?a:null==t?void 0:t.estatus)&&void 0!==n?n:null,u=Number(m);return Number.isFinite(u)?u:null}get statusCtrl(){return this.formStatus.get("status")}isCreadoDisabled(t){var n;const a=Number(null===(n=this.statusCtrl)||void 0===n?void 0:n.value);return t===this.estatusReferenciaEnum.Creado&&a!==this.estatusReferenciaEnum.Creado}get estaEnSeguimiento(){return this.getEstatusActual(this.referido)===this.estatusReferenciaEnum.Seguimiento}ngOnInit(){var t=this;return(0,C.A)(function*(){const n=yield t.loadingCtrl.create({message:"Cargando datos..."});yield n.present();try{const a=yield(0,_._)(t.referidoService.getByID(t.id));t.referido=a.data;const l=t.getEstatusActual(t.referido);null!==l&&t.formStatus.patchValue({status:l},{emitEvent:!1}),t.getSeguimientos()}catch(a){console.error("Error al cargar datos",a)}finally{n.dismiss()}})()}getSeguimientos(){this.seguimientoReferidoService.getSeguimientosReferido(this.id).subscribe({next:t=>{this.seguimientos=t.data||[],this.numSeguimientos=this.seguimientos.length}})}enviarFormularioStatus(){if(this.formEnviado)return;if(this.formEnviado=!0,this.formStatus.invalid)return this.formStatus.markAllAsTouched(),void(this.formEnviado=!1);const t=Number(this.formStatus.controls.status.value);this.referidoService.updateEstatus({id:this.id,estatusReferenciaEnum:t}).pipe((0,M.j)(()=>this.formEnviado=!1)).subscribe({next:a=>{a&&(this.toastController.create({message:"Estatus actualizado.",duration:3e3,color:"success",position:"top"}).then(l=>l.present()),this.getSeguimientos(),this.referido&&(this.referido.estatusReferenciaEnum=t,this.referido.estatusReferenciaID=t))}})}enviarFormulario(){if(this.formEnviado)return;if(this.formEnviado=!0,this.formulario.invalid)return this.formulario.markAllAsTouched(),void(this.formEnviado=!1);const t={comentario:(0,Q.H)(this.formulario.controls.comentario.value),referidoID:this.id};this.seguimientoReferidoService.save(t).pipe((0,M.j)(()=>this.formEnviado=!1)).subscribe({next:n=>{n&&(this.toastController.create({message:"Seguimiento guardado.",duration:3e3,color:"success",position:"top"}).then(a=>a.present()),this.getSeguimientos(),this.formulario.reset())}})}getControl(t){return this.formulario.get(t)}close(){this.modalCtrl.dismiss()}formatFecha(t){const n=new Date(t),a=n.getDate().toString().padStart(2,"0");let l=n.toLocaleString("es-MX",{month:"long"});return l=l.charAt(0).toUpperCase()+l.slice(1),`${a}-${l}-${n.getFullYear()}`}trackByIndex(t){return t}}return(i=r).\u0275fac=function(t){return new(t||i)(e.rXU(p.ok),e.rXU(s.W3),e.rXU(s.K_),e.rXU(s.Xi),e.rXU(N),e.rXU(W))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-modal",8,"seguimiento","referencia"]],inputs:{id:"id"},attrs:H,decls:44,vars:20,consts:[["sinSeg",""],[1,"modalHeader"],["slot","end"],["aria-label","Cerrar",1,"btn-close",3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[1,"modalform-title","ion-text-center"],[1,"section-card"],[1,"section-title"],[1,"status-form",3,"formGroup"],["okText","Ok","cancelText","Cancelar","label-placement","floating","label","Estatus seguimiento","formControlName","status",1,"inputForm",3,"ionBlur","interfaceOptions","compareWith"],[3,"value","disabled",4,"ngFor","ngForOf"],["color","danger",4,"ngIf"],[1,"actions-row"],[3,"click","disabled"],["class","section-card",4,"ngIf"],[1,"count"],["class","timeline",4,"ngIf","ngIfElse"],["class","actions-row",4,"ngIf"],[3,"value","disabled"],["color","danger"],[3,"formGroup"],["formControlName","comentario","label-placement","floating","label","Seguimiento","autoGrow","true","rows","4","maxlength","500","placeholder","Escribe tu seguimiento",1,"inputForm"],[1,"timeline"],["class","tl-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tl-item"],[1,"tl-dot"],[1,"tl-card"],[1,"tl-row"],["name","time-outline"],[1,"tl-date"],[1,"tl-text"],[1,"muted"],["size","small","fill","clear",3,"click"]],template:function(t,n){if(1&t){const a=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-button",3),e.bIt("click",function(){return e.eBV(a),e.Njj(n.close())}),e.nrm(4,"ion-icon",4),e.k0s()()()(),e.j41(5,"ion-content",5)(6,"h2",6),e.EFF(7,"Seguimiento de referido"),e.k0s(),e.j41(8,"ion-card",7)(9,"ion-card-header")(10,"ion-card-title",8),e.EFF(11,"Estatus"),e.k0s()(),e.j41(12,"ion-card-content")(13,"form",9)(14,"ion-select",10),e.bIt("ionBlur",function(){return e.eBV(a),e.Njj(null==n.statusCtrl?null:n.statusCtrl.markAsTouched())}),e.DNE(15,L,2,3,"ion-select-option",11),e.k0s(),e.DNE(16,J,2,0,"ion-text",12),e.j41(17,"div",13)(18,"ion-button",14),e.bIt("click",function(){return e.eBV(a),e.Njj(n.enviarFormularioStatus())}),e.EFF(19," Actualizar estatus "),e.k0s()()()()(),e.j41(20,"ion-card",7)(21,"ion-card-header")(22,"ion-card-title",8),e.EFF(23,"Estatus"),e.k0s()(),e.j41(24,"ion-card-content")(25,"form",9)(26,"ion-select",10),e.bIt("ionBlur",function(){return e.eBV(a),e.Njj(null==n.statusCtrl?null:n.statusCtrl.markAsTouched())}),e.DNE(27,K,2,3,"ion-select-option",11),e.k0s(),e.DNE(28,Z,2,0,"ion-text",12),e.j41(29,"div",13)(30,"ion-button",14),e.bIt("click",function(){return e.eBV(a),e.Njj(n.enviarFormularioStatus())}),e.EFF(31," Actualizar estatus "),e.k0s()()()()(),e.DNE(32,ee,11,5,"ion-card",15),e.j41(33,"ion-card",7)(34,"ion-card-header")(35,"ion-card-title",8),e.EFF(36," Seguimientos "),e.j41(37,"span",16),e.EFF(38),e.k0s()()(),e.j41(39,"ion-card-content"),e.DNE(40,ne,3,6,"div",17)(41,ie,2,0,"ng-template",null,0,e.C5r)(43,oe,3,1,"div",18),e.k0s()()()}if(2&t){let a,l;const m=e.sdS(42);e.R7$(5),e.Y8G("fullscreen",!1),e.R7$(8),e.Y8G("formGroup",n.formStatus),e.R7$(),e.Y8G("interfaceOptions",e.lJ4(18,w))("compareWith",n.compareNum),e.R7$(),e.Y8G("ngForOf",n.estatus),e.R7$(),e.Y8G("ngIf",(null==n.statusCtrl?null:n.statusCtrl.invalid)&&(null==n.statusCtrl?null:n.statusCtrl.touched)),e.R7$(2),e.Y8G("disabled",n.formEnviado),e.R7$(7),e.Y8G("formGroup",n.formStatus),e.R7$(),e.Y8G("interfaceOptions",e.lJ4(19,w))("compareWith",n.compareNum),e.R7$(),e.Y8G("ngForOf",n.estatus),e.R7$(),e.Y8G("ngIf",(null==n.statusCtrl?null:n.statusCtrl.invalid)&&(null==n.statusCtrl?null:n.statusCtrl.touched)),e.R7$(2),e.Y8G("disabled",n.formEnviado),e.R7$(2),e.Y8G("ngIf",(null==n.referido?null:n.referido.estatusReferenciaEnum)==n.estatusReferenciaEnum.Seguimiento),e.R7$(6),e.SpI("(",n.numSeguimientos,")"),e.R7$(2),e.Y8G("ngIf",(null!==(a=null==n.seguimientos?null:n.seguimientos.length)&&void 0!==a?a:0)>0)("ngIfElse",m),e.R7$(3),e.Y8G("ngIf",(null!==(l=null==n.seguimientos?null:n.seguimientos.length)&&void 0!==l?l:0)>5)}},dependencies:[s.bv,s.Jm,s.QW,s.b_,s.I9,s.ME,s.tN,s.W9,s.eU,s.iq,s.Nm,s.Ip,s.IO,s.nc,s.ai,s.Je,s.Gw,p.X1,p.qT,p.BC,p.cb,p.tU,p.j4,p.JD,g.MD,g.Sq,g.bT,g.P9],styles:['@charset "UTF-8";.modalform-title[_ngcontent-%COMP%]{margin:4px 0 12px;letter-spacing:.2px}.section-card[_ngcontent-%COMP%]{border-radius:16px;box-shadow:0 8px 18px #0000000f;margin-bottom:14px}.section-title[_ngcontent-%COMP%]{font-size:16px;font-weight:700}.count[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-medium)}.detail-grid[_ngcontent-%COMP%]{--label-w: 120px}.detail-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:var(--label-w) 1fr;column-gap:12px;row-gap:8px;padding:6px 0;border-bottom:1px solid rgba(0,0,0,.05)}.detail-row[_ngcontent-%COMP%]:last-child{border-bottom:0}.detail-label[_ngcontent-%COMP%]{font-weight:600;color:var(--ion-color-medium);text-align:right;white-space:nowrap}.detail-value[_ngcontent-%COMP%]{line-height:1.25;word-break:break-word}.chip[_ngcontent-%COMP%]{height:28px;--background: #fff;--color: var(--ion-color-dark);--padding-start: 6px;--padding-end: 8px}.actions-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:8px}.timeline[_ngcontent-%COMP%]{position:relative;margin-top:6px;padding-left:16px}.timeline[_ngcontent-%COMP%]:before{content:"";position:absolute;left:7px;top:0;bottom:0;width:2px;background:#00000014}.tl-item[_ngcontent-%COMP%]{position:relative;margin:8px 0 12px}.tl-dot[_ngcontent-%COMP%]{position:absolute;left:-1px;top:6px;width:12px;height:12px;border-radius:50%;background:var(--ion-color-primary);box-shadow:0 0 0 3px rgba(var(--ion-color-primary-rgb, 56, 128, 255),.15)}.tl-card[_ngcontent-%COMP%]{background:var(--ion-background-color, #fff);border:1px solid rgba(0,0,0,.06);border-radius:12px;padding:8px 12px;box-shadow:0 2px 6px #0000000a}.tl-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;margin-bottom:4px;color:var(--ion-color-medium);font-size:12px}.tl-text[_ngcontent-%COMP%]{white-space:pre-wrap;line-height:1.25}.muted[_ngcontent-%COMP%]{color:var(--ion-color-medium)}@media (max-width: 420px){.detail-grid[_ngcontent-%COMP%]{--label-w: 100px}.detail-label[_ngcontent-%COMP%]{text-align:left}.detail-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.modalHeader[_ngcontent-%COMP%]{box-shadow:none}.modalHeader[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--padding-end: calc(env(safe-area-inset-right) + 20px) ;--padding-start: calc(env(safe-area-inset-left) + 12px) ;--min-height: 44px;--border-width: 0;--border-color: transparent;background:transparent;box-shadow:none}.btn-close[_ngcontent-%COMP%]{width:36px;height:36px;--border-radius: 9999px;--background: rgba(0,0,0,.06);--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0;box-shadow:none}.btn-close[_ngcontent-%COMP%]:hover{--background: rgba(0,0,0,.1)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: #fff !important}']}),r})();var re=c(8311),se=c(6897),le=c(2101),ce=c(7248),F=c(2490);const ue=["selectableComponent"],de=()=>[20,50,100];function me(i,r){if(1&i){const o=e.RV6();e.j41(0,"ion-col",10)(1,"ion-item",11)(2,"ion-label",12),e.EFF(3,"Filtro por empresa"),e.k0s(),e.j41(4,"ionic-selectable",30),e.bIt("onChange",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.onEmpresaSelect(n))})("onClear",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.onEmpresaClear(n))}),e.k0s()()()}if(2&i){const o=e.XpG();e.R7$(4),e.Y8G("items",o.empresas)("canSearch",!0)("canClear",!0)}}function pe(i,r){1&i&&(e.j41(0,"ion-item",33)(1,"p",34),e.EFF(2," Solo se muestran los primeros 30 usuarios encontrados. Si no encuentra el deseado, utilice el buscador para obtener un resultado m\xe1s preciso. "),e.k0s()())}function fe(i,r){if(1&i){const o=e.RV6();e.j41(0,"ion-col",10)(1,"ion-item",11)(2,"ion-label",12),e.EFF(3,"Filtro por embajador"),e.k0s(),e.j41(4,"ionic-selectable",31,0),e.bIt("onSearch",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.onSearchChange(n))})("onOpen",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.onOpen(n))})("onChange",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.onUsuarioSelect(n))})("onClear",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.onUsuarioClear(n))}),e.DNE(6,pe,3,0,"ng-template",32),e.k0s()()()}if(2&i){const o=e.XpG();e.R7$(4),e.Y8G("items",o.usuarios)("searchFailText","No se encontraron usuarios.")("canSearch",!0)("canClear",!0)}}function ge(i,r){1&i&&(e.j41(0,"th",35),e.EFF(1," Nombre "),e.k0s())}function he(i,r){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=r.$implicit;e.R7$(),e.SpI(" ",o.nombre," ")}}function _e(i,r){1&i&&(e.j41(0,"th",35),e.EFF(1," Contacto "),e.k0s())}function ve(i,r){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=r.$implicit;e.R7$(),e.Lme(" ",o.email," ",o.celular," ")}}function Ce(i,r){1&i&&(e.j41(0,"th",35),e.EFF(1," Producto "),e.k0s())}function be(i,r){if(1&i&&(e.j41(0,"div")(1,"small",38),e.EFF(2),e.k0s()()),2&i){const o=e.XpG().$implicit;e.R7$(),e.Y8G("ngClass",o.productoVigente?"text-success":"text-danger"),e.R7$(),e.SpI(" ",o.productoVigente?"Vigente":"No vigente"," ")}}function Re(i,r){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.DNE(2,be,3,2,"div",37),e.k0s()),2&i){const o=r.$implicit;e.R7$(),e.SpI(" ",o.producto," "),e.R7$(),e.Y8G("ngIf",null!==o.vigente)}}function Se(i,r){1&i&&(e.j41(0,"th",35),e.EFF(1," Embajador "),e.k0s())}function Ee(i,r){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=r.$implicit;e.R7$(),e.SpI(" ",o.embajador," ")}}function Fe(i,r){1&i&&(e.j41(0,"th",35),e.EFF(1," Empresa "),e.k0s())}function xe(i,r){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=r.$implicit;e.R7$(),e.SpI(" ",o.empresa," ")}}function je(i,r){1&i&&(e.j41(0,"th",35),e.EFF(1," Estatus Referencia "),e.k0s())}function Ie(i,r){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=r.$implicit;e.R7$(),e.SpI(" ",o.estatusRerefencia," ")}}function ye(i,r){1&i&&e.nrm(0,"tr",39)}function De(i,r){if(1&i){const o=e.RV6();e.j41(0,"tr",40),e.bIt("click",function(){const n=e.eBV(o).$implicit,a=e.XpG();return e.Njj(a.seguimientoModal(n.id))}),e.k0s()}}function Te(i,r){if(1&i&&(e.j41(0,"tr",41)(1,"td",42),e.EFF(2," No se encontraron registros disponibles. "),e.k0s()()),2&i){const o=e.XpG();e.R7$(),e.BMQ("colspan",o.displayedColumns.length)}}const Pe=[{path:"",component:(()=>{var i;class r{constructor(t,n,a,l,m,u,f){this.loadingCtrl=t,this.empresasService=n,this.grupoService=a,this.modalCtrl=l,this.route=m,this.usuarioService=u,this.referidoService=f,this.dataSourceTable=new d.I6,this.displayedColumns=[],this.allColumns=["Nombre","Email","Producto","Embajador","EstatusReferencia"],this.inputBuscar=new E.B,this.query="",this.empresaID=0,this.userid=0,this.inputBusquedaText="Buscar por nombre, email, celular o producto",this.RolesEnum=v.$u,this.grupos=[],this.empresas=[],this.estatus=[],this.filterEmpresID=0,this.filterGrupoID=0,this.filterEstatusEnum=void 0,this.filterUsuario=0,this.usuarios=[],this.searchSubject=new E.B,this.destroy$=new E.B,this.setupSearch()}ngAfterViewInit(){}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnInit(){var t=this;return(0,C.A)(function*(){var n;let l=t.route.snapshot.data.resolverData.usuario;if(t.rolUsuario=null===(n=l.roles)||void 0===n?void 0:n.enumValue,t.estatus=G(),t.userid=l.id,t.displayedColumns=[...t.allColumns],t.rolUsuario===v.$u.Admin){const f=t.displayedColumns.indexOf("Producto");-1!==f&&t.displayedColumns.splice(f+1,0,"Empresa"),t.inputBusquedaText="Buscar por nombre, email, celular, producto, empresa o grupo"}const m=yield t.loadingCtrl.create({message:"Cargando datos..."});yield m.present();try{if(t.rolUsuario==v.$u.Socio){const u=yield(0,_._)(t.usuarioService.getEmpresaByUsuario(t.userid));t.empresaID=u.data.id}else{const u=yield(0,_._)(t.empresasService.getAllEmpresas());t.empresas=(null==u?void 0:u.data)||[];const f=yield(0,_._)(t.grupoService.getAllGrupos());t.grupos=(null==f?void 0:f.data)||[]}t.dataSourceTable.paginator=t.paginator,t.loadtable()}catch(u){console.error("Error al cargar datos",u)}finally{m.dismiss()}t.inputBuscar.pipe((0,I.B)(1e3),(0,O.F)(),(0,U.Q)(t.destroy$)).subscribe(u=>{t.query=u.toString(),t.loadtable()})})()}loadtable(){switch(this.rolUsuario){case v.$u.Admin:this.loadtableAll();break;case v.$u.Socio:this.loadtableByEmpresa()}}loadtableAll(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,y.h)(this.sort.sortChange,this.paginator.page).pipe((0,D.Z)({}),(0,T.n)(()=>this.referidoService.getAllReferidosPaginated({page:this.paginator.pageIndex,size:this.paginator.pageSize,sortBy:this.sort.active,sortDir:this.sort.direction,searchQuery:this.query,grupoID:this.filterGrupoID,empresaID:this.filterEmpresID,statusEnum:this.filterEstatusEnum,usuarioID:this.filterUsuario}).pipe((0,P.W)(()=>(0,$.of)(null)))),(0,B.T)(t=>null===t?[]:(this.total=t.data.total,t.data.items))).subscribe(t=>{this.dataSourceTable=new d.I6(t)})}loadtableByEmpresa(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,y.h)(this.sort.sortChange,this.paginator.page).pipe((0,D.Z)({}),(0,T.n)(()=>this.referidoService.getReferidosByEmpresaPaginated({id:this.empresaID,page:this.paginator.pageIndex,size:this.paginator.pageSize,sortBy:this.sort.active,sortDir:this.sort.direction,searchQuery:this.query,statusEnum:this.filterEstatusEnum,usuarioID:this.filterUsuario}).pipe((0,P.W)(()=>(0,$.of)(null)))),(0,B.T)(t=>null===t?[]:(this.total=t.data.total,t.data.items))).subscribe(t=>{this.dataSourceTable=new d.I6(t)})}seguimientoModal(t){var n=this;return(0,C.A)(function*(){const a=yield n.modalCtrl.create({component:ae,cssClass:"modal-empresa",componentProps:{id:t}});yield a.present(),yield a.onDidDismiss(),n.loadtable()})()}formatFecha(t){if(null==t)return"No aplica";const n=new Date(t),a=n.getDate().toString().padStart(2,"0");let l=n.toLocaleString("es-MX",{month:"long"});return l=l.charAt(0).toUpperCase()+l.slice(1),`${a} ${l} ${n.getFullYear()}`}onGrupoSelect(t){null!=t.value&&null!=t.value&&(this.filterGrupoID=t.value.id,this.loadtable())}onGrupoClear(t){this.filterGrupoID=0,this.loadtable()}onEmpresaSelect(t){null!=t.value&&null!=t.value&&(this.filterEmpresID=t.value.id,this.loadtable())}onEmpresaClear(t){this.filterEmpresID=0,this.loadtable()}onEstatusSelect(t){null!=t.value&&null!=t.value&&(this.filterEstatusEnum=t.value.valor,this.loadtable())}onEstatusClear(t){this.filterEstatusEnum=void 0,this.loadtable()}onSearchChange(t){t.component.startSearch(),this.searchSubject.next(t)}setupSearch(){this.searchSubject.pipe((0,I.B)(300)).subscribe(t=>{const n=t.text.trim();if(n.length<2&&""!=n)return t.component.items=this.usuarios,void t.component.endSearch();this.usuarioService.busquedaUsuario(n.toLowerCase()).subscribe(a=>{this.usuarios=a.data,t.component.items=this.usuarios,t.component.endSearch()},a=>{t.component.items=[],t.component.endSearch()})})}onOpen(t){this.selectableComponent&&(this.selectableComponent._onSearchbarClear=function(){this._searchText="",this._filterItems()})}onUsuarioSelect(t){null!=t.value&&null!=t.value&&(this.filterUsuario=t.value.id,this.loadtable())}onUsuarioClear(t){this.filterUsuario=0,this.loadtable()}viewQR(t){var n=this;return(0,C.A)(function*(){var a=yield(0,_._)(n.referidoService.getQR(t));const l=yield n.modalCtrl.create({component:A,cssClass:"modal-empresa",componentProps:{imagenBase64:a.data}});yield l.present(),yield l.onDidDismiss()})()}}return(i=r).\u0275fac=function(t){return new(t||i)(e.rXU(s.Xi),e.rXU(re.z),e.rXU(se.b),e.rXU(s.W3),e.rXU(le.nX),e.rXU(ce.o),e.rXU(N))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-referencias"]],viewQuery:function(t,n){if(1&t&&(e.GBs(S.iy,5),e.GBs(b.B4,5),e.GBs(ue,5)),2&t){let a;e.mGM(a=e.lsd())&&(n.paginator=a.first),e.mGM(a=e.lsd())&&(n.sort=a.first),e.mGM(a=e.lsd())&&(n.selectableComponent=a.first)}},standalone:!1,decls:52,vars:14,consts:[["selectableComponent",""],[1,"pagesHeader"],["slot","start"],["name","star","color","white"],[1,"pagesContent"],[1,"ion-align-items-center"],["size","12","size-md","9",1,"ion-text-center"],["autocomplete","off",1,"inputBusqueda",3,"ionInput","placeholder"],["slot","end","name","search","aria-hidden","true"],["size","12","size-md","3","class","ion-text-center",4,"ngIf"],["size","12","size-md","3",1,"ion-text-center"],[1,"inputBusqueda"],["position","floating"],["item-content","","itemValueField","valor","closeButtonSlot","end","itemTextField","nombre","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],[1,"referidosHeader"],[1,"title"],[2,"overflow-x","auto"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","Nombre"],["mat-header-cell","","style","padding-left: 1rem;","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","style","padding-left: 1rem;",4,"matCellDef"],["matColumnDef","Email"],["matColumnDef","Producto"],["matColumnDef","Embajador"],["matColumnDef","Empresa"],["matColumnDef","EstatusReferencia"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","mydivoutermulti elemento-renglon row_clickable",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"length","pageSizeOptions","pageSize"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","razonSocial","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","nombreCompleto","closeButtonText","Cancelar","searchPlaceholder","Buscar usuario...","clearButtonText","Limpiar",3,"onSearch","onOpen","onChange","onClear","items","searchFailText","canSearch","canClear"],["ionicSelectableMessageTemplate",""],["text-wrap",""],[2,"color","grey","font-size","small"],["mat-header-cell","","mat-sort-header","",2,"padding-left","1rem"],["mat-cell","",2,"padding-left","1rem"],[4,"ngIf"],[3,"ngClass"],["mat-header-row",""],["mat-row","",1,"mydivoutermulti","elemento-renglon","row_clickable",3,"click"],[1,"mat-row"],[2,"text-align","center","padding","1rem"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title")(5,"h1"),e.nrm(6,"ion-icon",3),e.EFF(7," Referencia"),e.k0s()()()(),e.j41(8,"ion-content",4)(9,"div")(10,"ion-grid")(11,"ion-row",5)(12,"ion-col",6)(13,"ion-input",7),e.bIt("ionInput",function(l){return n.inputBuscar.next(l.detail.value||"")}),e.nrm(14,"ion-icon",8),e.k0s()()(),e.j41(15,"ion-row",5),e.DNE(16,me,5,3,"ion-col",9)(17,fe,7,4,"ion-col",9),e.j41(18,"ion-col",10)(19,"ion-item",11)(20,"ion-label",12),e.EFF(21,"Filtro por estatus"),e.k0s(),e.j41(22,"ionic-selectable",13),e.bIt("onChange",function(l){return n.onEstatusSelect(l)})("onClear",function(l){return n.onEstatusClear(l)}),e.k0s()()()()()(),e.j41(23,"ion-card")(24,"ion-card-header",14)(25,"ion-card-title",15),e.EFF(26,"Referencias"),e.k0s()(),e.j41(27,"ion-card-content")(28,"div",16)(29,"table",17),e.qex(30,18),e.DNE(31,ge,2,0,"th",19)(32,he,2,1,"td",20),e.bVm(),e.qex(33,21),e.DNE(34,_e,2,0,"th",19)(35,ve,2,2,"td",20),e.bVm(),e.qex(36,22),e.DNE(37,Ce,2,0,"th",19)(38,Re,3,2,"td",20),e.bVm(),e.qex(39,23),e.DNE(40,Se,2,0,"th",19)(41,Ee,2,1,"td",20),e.bVm(),e.qex(42,24),e.DNE(43,Fe,2,0,"th",19)(44,xe,2,1,"td",20),e.bVm(),e.qex(45,25),e.DNE(46,je,2,0,"th",19)(47,Ie,2,1,"td",20),e.bVm(),e.DNE(48,ye,1,0,"tr",26)(49,De,1,0,"tr",27)(50,Te,3,1,"tr",28),e.k0s()(),e.nrm(51,"mat-paginator",29),e.k0s()()()),2&t&&(e.R7$(13),e.Y8G("placeholder",n.inputBusquedaText),e.R7$(3),e.Y8G("ngIf",n.rolUsuario===n.RolesEnum.Admin),e.R7$(),e.Y8G("ngIf",n.rolUsuario===n.RolesEnum.Admin),e.R7$(5),e.Y8G("items",n.estatus)("canSearch",!0)("canClear",!0),e.R7$(7),e.Y8G("dataSource",n.dataSourceTable),e.R7$(19),e.Y8G("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),e.R7$(),e.Y8G("matRowDefColumns",n.displayedColumns),e.R7$(2),e.Y8G("length",n.total)("pageSizeOptions",e.lJ4(13,de))("pageSize",50))},dependencies:[g.YU,g.bT,s.QW,s.b_,s.I9,s.ME,s.tN,s.hU,s.W9,s.lO,s.eU,s.iq,s.$w,s.uz,s.he,s.MC,s.ln,s.BC,s.ai,s.Gw,d.Zl,d.tL,d.ji,d.cC,d.YV,d.iL,d.KS,d.$R,d.YZ,d.NB,d.ky,S.iy,b.B4,b.aE,F.ec,F.pF],styles:[".text-success[_ngcontent-%COMP%]{color:green}.text-danger[_ngcontent-%COMP%]{color:red}"]}),r})()}];let $e=(()=>{var i;class r{}return(i=r).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[j.iI.forChild(Pe),j.iI]}),r})(),Be=(()=>{var i;class r{}return(i=r).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[g.MD,p.YN,s.bv,$e,d.tP,S.Ou,b.NQ,F.ec]}),r})()}}]);