"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7273],{7273:(ut,j,w)=>{w.r(j),w.d(j,{CelulasPageModule:()=>lt});var G=w(2881),Q=w(9417),$=w(3092),B=w(9870),t=w(1360),V=w(7248);const L=["svgRef"],q=n=>({"hover-group":n});function A(n,h){if(1&n){const s=t.RV6();t.qSk(),t.j41(0,"g",17),t.bIt("click",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.nivelSuperior(0))}),t.nrm(1,"rect",23),t.j41(2,"text",19),t.EFF(3,"\u{1f3e0}"),t.k0s()()}if(2&n){const s=t.XpG();t.R7$(),t.BMQ("x",s.baseNode.x-80)("y",s.baseNode.y),t.R7$(),t.BMQ("x",s.baseNode.x-80)("y",s.baseNode.y+20)}}function U(n,h){if(1&n){const s=t.RV6();t.qSk(),t.j41(0,"g",17),t.bIt("click",function(){t.eBV(s);const e=t.XpG();return t.Njj(e.nivelSuperior(e.baseNode.parentId))}),t.nrm(1,"rect",23),t.j41(2,"text",19),t.EFF(3,"\u2b06\ufe0f"),t.k0s()()}if(2&n){const s=t.XpG();t.R7$(),t.BMQ("x",s.baseNode.x-40)("y",s.baseNode.y),t.R7$(),t.BMQ("x",s.baseNode.x-40)("y",s.baseNode.y+20)}}function J(n,h){if(1&n&&(t.qSk(),t.nrm(0,"path",24)),2&n){const s=t.XpG();t.BMQ("d",s.busVerticalPath)}}function K(n,h){if(1&n&&(t.qSk(),t.nrm(0,"path",24)),2&n){const s=t.XpG();t.BMQ("d",s.busHorizontalPath)}}function Z(n,h){if(1&n&&(t.qSk(),t.nrm(0,"path",24)),2&n){const s=t.XpG().$implicit;t.BMQ("d",s.ruta)}}function tt(n,h){if(1&n&&(t.qSk(),t.j41(0,"g"),t.nrm(1,"rect",27),t.j41(2,"text",28),t.EFF(3),t.k0s()()),2&n){const s=t.XpG().$implicit;t.R7$(),t.BMQ("x",s.x+s.w-22)("y",s.y+4),t.R7$(),t.BMQ("x",s.x+s.w-13)("y",s.y+17),t.R7$(),t.SpI(" ",s.childrenCount," ")}}function et(n,h){if(1&n&&(t.qSk(),t.qex(0),t.nrm(1,"rect",31),t.bVm()),2&n){const s=h.index,o=t.XpG(2).$implicit;t.R7$(),t.BMQ("x",o.x+10+22*s)("y",o.y+o.h+2)}}function st(n,h){if(1&n&&(t.qSk(),t.j41(0,"text",32),t.EFF(1),t.k0s()),2&n){const s=t.XpG(2).$implicit;t.BMQ("x",s.x+10+88+10)("y",s.y+s.h+9),t.R7$(),t.SpI(" +",s.childrenCount-4," ")}}function ot(n,h){if(1&n&&(t.qSk(),t.j41(0,"g"),t.DNE(1,et,2,2,"ng-container",29)(2,st,2,3,"text",30),t.k0s()),2&n){const s=t.XpG().$implicit;t.R7$(),t.Y8G("ngForOf",s.childrenPreview),t.R7$(),t.Y8G("ngIf",s.childrenCount>4)}}function nt(n,h){if(1&n){const s=t.RV6();t.qSk(),t.j41(0,"g",25),t.bIt("click",function(){const e=t.eBV(s).$implicit,r=t.XpG();return t.Njj(r.onNodeClick(e))}),t.DNE(1,Z,1,1,"path",21),t.nrm(2,"rect",18),t.j41(3,"text",19),t.EFF(4),t.k0s(),t.j41(5,"text",20),t.EFF(6),t.k0s(),t.DNE(7,tt,4,5,"g",26)(8,ot,3,2,"g",26),t.k0s()}if(2&n){const s=h.$implicit,o=t.XpG();t.Y8G("ngClass",t.eq3(15,q,"empresa"!==s.tipoNodo)),t.R7$(),t.Y8G("ngIf",s.parent),t.R7$(),t.BMQ("x",s.x)("y",s.y)("width",s.w)("height",s.h)("fill",o.gradientFor(s)),t.R7$(),t.BMQ("x",s.x+o.nodeTextLeftPadding)("y",s.y+25),t.R7$(),t.JRh(s.nombre),t.R7$(),t.BMQ("x",s.x+o.nodeTextLeftPadding)("y",s.y+40),t.R7$(),t.JRh(s.contacto),t.R7$(),t.Y8G("ngIf",1==s.nivel&&s.childrenCount>0),t.R7$(),t.Y8G("ngIf",1==s.nivel&&s.childrenPreview.length)}}let it=(()=>{var n;class h{constructor(o){this.usuarioSerivice=o,this.canvasWidth=1200,this.canvasHeight=800,this.defaultNodeW=180,this.defaultNodeH=60,this.topMargin=60,this.gapRootToHeaders=100,this.gapHeaderToItems=50,this.colGapX=600,this.rowGapItems=24,this.chipsMax=4,this.scale=1,this.panX=0,this.panY=0,this.transform="translate(0,0) scale(1)",this.isPanning=!1,this.startX=0,this.startY=0,this.precalculatedNodes=[],this.precalculatedNodesReversed=[],this.svgWidth=1200,this.nodeTextLeftPadding=16,this.busY=0,this.busVerticalPath="",this.busHorizontalPath="",this.measureCtx=null,this.onMouseDown=e=>{this.isPanning=!0,this.startX=e.clientX,this.startY=e.clientY},this.onMouseMove=e=>{this.isPanning&&(this.panX+=e.clientX-this.startX,this.panY+=e.clientY-this.startY,this.startX=e.clientX,this.startY=e.clientY,this.updateTransform())},this.onMouseUp=()=>{this.isPanning=!1},this.onWheel=e=>{e.preventDefault(),this.scale*=1+.1*(e.deltaY<0?1:-1),this.updateTransform()},this.baseNode=new Y,this.baseNode.nombre="Embassy",this.baseNode.contacto=""}ngOnInit(){const o=document.createElement("canvas");this.measureCtx=o.getContext("2d");const e=this.svgRef.nativeElement;e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("mouseleave",this.onMouseUp),e.addEventListener("wheel",this.onWheel,{passive:!1})}ngAfterViewInit(){const e=this.svgRef.nativeElement.getBoundingClientRect();e.width>0&&(this.svgWidth=e.width),this.loadDataCelula(0)}onResize(){const e=this.svgRef.nativeElement.getBoundingClientRect();e.width>0&&(this.svgWidth=e.width),this.recomputeCanvasSize(),this.fitToView()}onNodeClick(o){"empresa"!==o.tipoNodo&&this.loadDataCelula(o.usuarioId)}onRectClick(o){"number"!=typeof o?"empresa"!==o.tipoNodo&&this.loadDataCelula(o.usuarioId):this.loadDataCelula(o)}gradientFor(o,e=!1){return e?"url(#gradRoot)":o&&"empresa"===o.tipoNodo?"url(#gradEmpresa)":"url(#gradAdmin)"}measureNodeWidth(o,e){const r=this.measureCtx;if(!r)return this.defaultNodeW;const g=this.nodeTextLeftPadding;r.font="18px sans-serif";const _=r.measureText(o||"").width;r.font="12px sans-serif";const b=r.measureText(e||"").width,x=Math.max(_,b);return Math.max(this.defaultNodeW,Math.ceil(x+g+16))}recomputeCanvasSize(){var o;const r=[this.baseNode,...this.precalculatedNodes];if(!r.length)return this.canvasWidth=1200,void(this.canvasHeight=800);const g=Math.min(...r.map(d=>d.x)),N=Math.max(...r.map(d=>d.x+d.w)),_=Math.min(...r.map(d=>d.y)),k=Math.max(...r.map(d=>d.y+d.h))-_+320,p=null===(o=this.svgRef)||void 0===o?void 0:o.nativeElement,X=(null==p?void 0:p.clientHeight)||600;this.canvasWidth=Math.max(N-g+320,(null==p?void 0:p.clientWidth)||1200),this.canvasHeight=Math.max(k,X)}nivelSuperior(o){this.loadDataCelula(o)}loadDataCelula(o){this.precalculatedNodes=[],this.precalculatedNodesReversed=[],this.busVerticalPath="",this.busHorizontalPath="",this.panX=0,this.panY=0,this.scale=1,this.updateTransform(),this.usuarioSerivice.getCelulaFromHere(o).subscribe({next:e=>{var r,g,N,_,b,x;const k=0!==o;this.baseNode=null!==(r=e.nivel1)&&void 0!==r?r:new Y,this.baseNode.parentId=null!==(g=null===(N=e.nivel1)||void 0===N?void 0:N.parentId)&&void 0!==g?g:0,this.baseNode.tipoNodo="usuario",this.baseNode.w=this.measureNodeWidth(this.baseNode.nombre,this.baseNode.contacto),this.baseNode.h=this.defaultNodeH;const p=this.svgWidth/2;this.baseNode.x=Math.round(p-this.baseNode.w/2),this.baseNode.y=this.topMargin;const M=null!==(_=e.nivel2)&&void 0!==_?_:[],X=null!==(b=e.nivel3)&&void 0!==b?b:[],d=null!==(x=e.nivel4)&&void 0!==x?x:[];if(k){this.busVerticalPath="",this.busHorizontalPath="";const v=M.map(f=>{const l=new Y;l.usuarioId=f.usuarioId,l.nombre=f.nombre,l.contacto=f.contacto,l.parent=this.baseNode,l.nivel=1,l.tipoNodo="empresa",l.w=this.measureNodeWidth(l.nombre,l.contacto),l.h=this.defaultNodeH;const m=d.filter(a=>a.parentId===l.usuarioId);return l.childrenCount=m.length,l.childrenPreview=m.slice(0,this.chipsMax).map(a=>a.nombre),l.children=m.map(a=>a.nombre),l}),i=this.baseNode.x+this.baseNode.w/2;let I=this.baseNode.y+this.baseNode.h+this.gapHeaderToItems;return v.forEach(f=>{f.x=Math.round(i-f.w/2),f.y=I,this.precalculatedNodes.push(f),I+=f.h+this.rowGapItems}),this.precalculatedNodesReversed=this.precalculatedNodes.slice().reverse(),this.recomputeCanvasSize(),void this.fitToView()}const F=p-(Math.max(1,M.length)-1)*this.colGapX/2,c=[];let W=0;for(const v of M){const i=new Y;i.usuarioId=v.usuarioId,i.nombre=v.nombre,i.contacto=v.contacto,i.parent=this.baseNode,i.nivel=0,i.tipoNodo="usuario",i.w=this.measureNodeWidth(i.nombre,i.contacto),i.h=this.defaultNodeH,i.x=Math.round(F+W*this.colGapX-i.w/2),i.y=this.baseNode.y+this.baseNode.h+this.gapRootToHeaders,c.push(i),this.precalculatedNodes.push(i);let l=X.filter(m=>m.parentId===v.usuarioId).map(m=>{const a=new Y;a.usuarioId=m.usuarioId,a.nombre=m.nombre,a.contacto=m.contacto,a.parent=i,a.nivel=1,a.tipoNodo="empresa",a.w=this.measureNodeWidth(a.nombre,a.contacto),a.h=this.defaultNodeH;const u=d.filter(y=>y.parentId===a.usuarioId);return a.childrenCount=u.length,a.childrenPreview=u.slice(0,this.chipsMax).map(y=>y.nombre),a.children=u.map(y=>y.nombre),a});if(l.length>10&&(l=l.slice(0,10)),1===M.length){const m=i.x+i.w/2;let a=i.y+i.h+this.gapHeaderToItems;l.forEach(u=>{u.x=Math.round(m-u.w/2),u.y=a,this.precalculatedNodes.push(u),a+=u.h+this.rowGapItems})}else{const a=Math.min(4,Math.max(1,Math.ceil(l.length/10)));let u=Array.from({length:a},()=>[]);const y=new Array(a).fill(0);l.forEach(R=>{let C=0;for(let P=1;P<a;P++)y[P]<y[C]&&(C=P);u[C].push(R),y[C]+=R.h+this.rowGapItems});const S=u.map(R=>R.reduce((C,P)=>Math.max(C,P.w),0)),z=24,ht=S.reduce((R,C)=>R+C,0)+z*(a-1),dt=i.y+i.h+this.gapHeaderToItems;let D=i.x+i.w/2-ht/2;u.forEach((R,C)=>{const P=S[C];let O=dt;R.forEach(T=>{T.x=Math.round(D+(P-T.w)/2),T.y=O,this.precalculatedNodes.push(T),O+=T.h+this.rowGapItems}),D+=P+z})}W++}if(c.length>0){const v=this.baseNode.x+this.baseNode.w/2;if(1===c.length)this.busY=c[0].y,this.busVerticalPath=`M ${v} ${this.baseNode.y+this.baseNode.h} L ${v} ${this.busY}`,this.busHorizontalPath="",c[0].busY=this.busY;else{this.busY=this.baseNode.y+this.baseNode.h+Math.floor(this.gapRootToHeaders/2);const i=c.map(l=>l.x+l.w/2),I=Math.min(...i),f=Math.max(...i);this.busVerticalPath=`M ${v} ${this.baseNode.y+this.baseNode.h} L ${v} ${this.busY}`,this.busHorizontalPath=`M ${I} ${this.busY} L ${f} ${this.busY}`,c.forEach(l=>l.busY=this.busY)}}this.precalculatedNodesReversed=this.precalculatedNodes.slice().reverse(),this.recomputeCanvasSize(),this.fitToView()}})}fitToView(){const o=[this.baseNode,...this.precalculatedNodes];if(!o.length)return;const e=Math.min(...o.map(c=>c.x)),r=Math.min(...o.map(c=>c.y)),g=Math.max(...o.map(c=>c.x+c.w)),N=Math.max(...o.map(c=>c.y+c.h)),_=this.svgRef.nativeElement,b=_.clientWidth,x=_.clientHeight,k=Math.max(1,g-e),p=Math.max(1,N-r);this.scale=.7*Math.max(.2,Math.min((b-240)/k,(x-240)/p));const F=r+p/2;this.panX=b/2-this.scale*(e+k/2),this.panY=x/2-this.scale*F,this.updateTransform()}updateTransform(){this.transform=`translate(${this.panX}, ${this.panY}) scale(${this.scale})`}}return(n=h).\u0275fac=function(o){return new(o||n)(t.rXU(V.o))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-celulas"]],viewQuery:function(o,e){if(1&o&&t.GBs(L,7),2&o){let r;t.mGM(r=t.lsd())&&(e.svgRef=r.first)}},hostBindings:function(o,e){1&o&&t.bIt("resize",function(){return e.onResize()},!1,t.tSv)},standalone:!1,decls:35,vars:20,consts:[["svgRef",""],[1,"pagesHeader"],["slot","start"],["name","grid","color","white"],[1,"org-svg"],["id","shadow","x","-20%","y","-20%","width","140%","height","140%"],["dx","0","dy","2","stdDeviation","2","flood-color","#000","flood-opacity","0.25"],["id","gradRoot","x1","0","y1","0","x2","0","y2","1"],["offset","0%","stop-color","#10b981"],["offset","100%","stop-color","#34d399"],["id","gradAdmin","x1","0","y1","0","x2","0","y2","1"],["offset","0%","stop-color","#16a34a"],["offset","100%","stop-color","#22c55e"],["id","gradEmpresa","x1","0","y1","0","x2","0","y2","1"],["offset","0%","stop-color","#2563eb"],["offset","100%","stop-color","#60a5fa"],["class","hover-group",3,"click",4,"ngIf"],[1,"hover-group",3,"click"],["rx","8","ry","8","filter","url(#shadow)",1,"zoomable"],["font-size","18","text-anchor","start","fill","white",1,"contenido"],["font-size","12","text-anchor","start","fill","white",1,"contenidoContacto"],["stroke-width","2","stroke","#444","fill","none",4,"ngIf"],[3,"ngClass","click",4,"ngFor","ngForOf"],["width","30","height","30","fill","#4CAF50","rx","4","ry","4",1,"hoverable"],["stroke-width","2","stroke","#444","fill","none"],[3,"click","ngClass"],[4,"ngIf"],["rx","8","ry","8","width","18","height","18","fill","#2e7d32"],["font-size","12","text-anchor","middle","fill","white"],[4,"ngFor","ngForOf"],["font-size","10","text-anchor","start","fill","#444",4,"ngIf"],["width","18","height","8","rx","4","ry","4","fill","#4CAF50"],["font-size","10","text-anchor","start","fill","#444"]],template:function(o,e){if(1&o){const r=t.RV6();t.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title")(5,"h1"),t.nrm(6,"ion-icon",3),t.EFF(7," Empresas "),t.k0s()()()(),t.j41(8,"ion-content"),t.qSk(),t.j41(9,"svg",4,0)(11,"defs")(12,"filter",5),t.nrm(13,"feDropShadow",6),t.k0s(),t.j41(14,"linearGradient",7),t.nrm(15,"stop",8)(16,"stop",9),t.k0s(),t.j41(17,"linearGradient",10),t.nrm(18,"stop",11)(19,"stop",12),t.k0s(),t.j41(20,"linearGradient",13),t.nrm(21,"stop",14)(22,"stop",15),t.k0s()(),t.j41(23,"g"),t.DNE(24,A,4,4,"g",16)(25,U,4,4,"g",16),t.j41(26,"g",17),t.bIt("click",function(){return t.eBV(r),t.Njj(e.onRectClick(0))}),t.nrm(27,"rect",18),t.j41(28,"text",19),t.EFF(29),t.k0s(),t.j41(30,"text",20),t.EFF(31),t.k0s()(),t.DNE(32,J,1,1,"path",21)(33,K,1,1,"path",21)(34,nt,9,17,"g",22),t.k0s()()()}2&o&&(t.R7$(9),t.BMQ("width",e.canvasWidth)("height",e.canvasHeight)("viewBox","0 0 "+e.canvasWidth+" "+e.canvasHeight),t.R7$(14),t.BMQ("transform",e.transform),t.R7$(),t.Y8G("ngIf",0!=e.baseNode.usuarioId),t.R7$(),t.Y8G("ngIf",e.baseNode.parentId>0),t.R7$(2),t.BMQ("x",e.baseNode.x)("y",e.baseNode.y)("width",e.baseNode.w)("height",e.baseNode.h)("fill",e.gradientFor(void 0,!0)),t.R7$(),t.BMQ("x",e.baseNode.x+e.nodeTextLeftPadding)("y",e.baseNode.y+25),t.R7$(),t.JRh(e.baseNode.nombre),t.R7$(),t.BMQ("x",e.baseNode.x+e.nodeTextLeftPadding)("y",e.baseNode.y+40),t.R7$(),t.JRh(e.baseNode.contacto),t.R7$(),t.Y8G("ngIf",e.busVerticalPath),t.R7$(),t.Y8G("ngIf",e.busHorizontalPath),t.R7$(),t.Y8G("ngForOf",e.precalculatedNodesReversed))},dependencies:[G.YU,G.Sq,G.bT,$.QW,$.W9,$.eU,$.iq,$.MC,$.BC,$.ai],styles:['@charset "UTF-8";.no-pad[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0}.org-svg[_ngcontent-%COMP%]{display:block;width:100%;height:100%;background:#f0f0f0;cursor:grab;-webkit-user-select:none;user-select:none}[_nghost-%COMP%], ion-content[_ngcontent-%COMP%]{height:100%}',"[_ngcontent-%COMP%]:root{--line: #94a3b8;--badge: #0ea5e9;--chip: #22c55e;--text: #ffffff}.contenido[_ngcontent-%COMP%]{opacity:.6;transition:opacity .15s ease;pointer-events:none}.contenidoContacto[_ngcontent-%COMP%]{opacity:0;transition:opacity .15s ease;pointer-events:none}.hover-group[_ngcontent-%COMP%]:hover   .contenido[_ngcontent-%COMP%], .hover-group[_ngcontent-%COMP%]:hover   .contenidoContacto[_ngcontent-%COMP%]{opacity:1}.zoomable[_ngcontent-%COMP%]{transition:transform .15s ease,filter .15s ease}.hover-group[_ngcontent-%COMP%]:hover   .zoomable[_ngcontent-%COMP%]{transform:translateY(-2px);filter:brightness(.98);cursor:pointer!important}.hoverable[_ngcontent-%COMP%]{transition:filter .15s ease}.hover-group[_ngcontent-%COMP%]:hover   .hoverable[_ngcontent-%COMP%]{filter:brightness(.95);cursor:pointer!important}"]}),h})();class Y{constructor(){this.usuarioId=0,this.nombre="",this.contacto="",this.parentId=0,this.parentNombre="",this.w=180,this.h=60,this.nivel=0,this.x=0,this.y=0,this.tipoNodo="usuario",this.children=[],this.childrenCount=0,this.childrenPreview=[]}get ruta(){if(!this.parent)return"";if(0===this.nivel&&void 0!==this.busY){const h=this.x+this.w/2;return`M ${h} ${this.busY} L ${h} ${this.y}`}if(1===this.nivel&&this.parent){const s=this.parent.y+this.parent.h,o=this.x+this.w/2;return`M ${this.parent.x+this.parent.w/2} ${s}\n              L ${o} ${s}\n              L ${o} ${this.y}`}return""}}const at=[{path:"",component:it}];let rt=(()=>{var n;class h{}return(n=h).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[B.iI.forChild(at),B.iI]}),h})(),lt=(()=>{var n;class h{}return(n=h).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[G.MD,Q.YN,$.bv,rt]}),h})()}}]);