"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4599],{4599:(he,Y,c)=>{c.r(Y),c.d(Y,{ProductosPageModule:()=>ge});var g=c(2881),m=c(9417),u=c(3092),U=c(9870),x=c(467),A=c(7550),F=c(2042),f=c(3662),X=c(1413),C=c(4843),ro=c(152),ao=c(3294),so=c(6977),z=c(7786),O=c(9172),q=c(5558),w=c(9437),Q=c(7673),H=c(6354),h=c(6231),uo=c(980),v=function(n){return n[n.CantidadFija=0]="CantidadFija",n[n.Porcentaje=1]="Porcentaje",n}(v||{});const co={CantidadFija:"Cantidad",Porcentaje:"Porcentaje"};var po=c(6704),L=c(3746),P=c(3069),_o=c(3),W=c(6152),fo=c(5460),o=c(1360),J=c(8311),Z=c(7643),go=c(5312);let K=(()=>{var n;class r{constructor(t){this.http=t,this.apiUrl=go.c.apiUrl+"api/Producto"}getAllProductosEmpresa(t){let e=(new Z.Nl).set("empresaID",t);return this.http.get(`${this.apiUrl}/GetProductosEmpresa`,{params:e})}getProductoAllPaginated(t){let e={page:t.page.toString(),size:t.size.toString(),sortBy:t.sortBy,sortDir:t.sortDir,searchQuery:t.searchQuery,grupoID:t.grupoID,empresaID:t.empresaID,vigenciaFilter:t.vigenciaFilter.toString()};return this.http.get(`${this.apiUrl}/GetAllProductoPaginated`,{params:e})}getProductoByEmpresaPaginated(t){let e={empresaID:t.id.toString(),page:t.page.toString(),size:t.size.toString(),sortBy:t.sortBy,sortDir:t.sortDir,searchQuery:t.searchQuery,vigenciaFilter:t.vigenciaFilter.toString()};return this.http.get(`${this.apiUrl}/GetProductoByEmpresaPaginated`,{params:e})}save(t){return this.http.post(`${this.apiUrl}/Save`,t)}}return(n=r).\u0275fac=function(t){return new(t||n)(o.KVO(Z.Qq))},n.\u0275prov=o.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),r})();var oo=c(7248),j=c(365);const ho=["class","producto form"],Co=()=>({header:"Tipo de comision"}),vo=()=>({header:"Tipo de comision por nivel"}),Fo=()=>({header:"Selecciona empresa"});function Po(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function jo(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function bo(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function To(n,r){if(1&n&&(o.j41(0,"ion-select-option",34),o.EFF(1),o.k0s()),2&n){const i=r.$implicit;o.Y8G("value",i.id),o.R7$(),o.Lme(" ",i.rfc," - ",i.razonSocial," ")}}function Eo(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function ko(n,r){if(1&n){const i=o.RV6();o.j41(0,"ion-col",10)(1,"ion-select",33),o.bIt("ionBlur",function(){let e;o.eBV(i);const l=o.XpG();return o.Njj(null==(e=l.getControl("empresa"))?null:e.markAsTouched())}),o.DNE(2,To,2,3,"ion-select-option",21),o.k0s(),o.DNE(3,Eo,2,0,"ion-text",12),o.k0s()}if(2&n){let i,t;const e=o.XpG();o.R7$(),o.AVh("invalid",(null==(i=e.getControl("empresa"))?null:i.invalid)&&(null==(i=e.getControl("empresa"))?null:i.touched)),o.Y8G("interfaceOptions",o.lJ4(5,Fo)),o.R7$(),o.Y8G("ngForOf",e.empresas),o.R7$(),o.Y8G("ngIf",(null==(t=e.getControl("empresa"))?null:t.invalid)&&(null==(t=e.getControl("empresa"))?null:t.touched))}}function Bo(n,r){if(1&n&&(o.j41(0,"ion-select-option",34),o.EFF(1),o.k0s()),2&n){const i=r.$implicit;o.Y8G("value",i.valor),o.R7$(),o.SpI(" ",i.nombre," ")}}function No(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function Do(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function Io(n,r){if(1&n){const i=o.RV6();o.j41(0,"ion-col",10)(1,"ion-input",35),o.bIt("ionBlur",function(){let e;o.eBV(i);const l=o.XpG();return o.Njj(null==(e=l.getControl("comisionCantidad"))?null:e.markAsTouched())}),o.k0s(),o.DNE(2,Do,2,0,"ion-text",12),o.k0s()}if(2&n){let i,t;const e=o.XpG();o.R7$(),o.AVh("invalid",(null==(i=e.getControl("comisionCantidad"))?null:i.invalid)&&(null==(i=e.getControl("comisionCantidad"))?null:i.touched)),o.R7$(),o.Y8G("ngIf",(null==(t=e.getControl("comisionCantidad"))?null:t.invalid)&&(null==(t=e.getControl("comisionCantidad"))?null:t.touched))}}function $o(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function yo(n,r){if(1&n){const i=o.RV6();o.j41(0,"ion-col",10)(1,"ion-input",36),o.bIt("ionBlur",function(){let e;o.eBV(i);const l=o.XpG();return o.Njj(null==(e=l.getControl("comisionPorcentaje"))?null:e.markAsTouched())}),o.k0s(),o.DNE(2,$o,2,0,"ion-text",12),o.k0s()}if(2&n){let i,t;const e=o.XpG();o.R7$(),o.AVh("invalid",(null==(i=e.getControl("comisionPorcentaje"))?null:i.invalid)&&(null==(i=e.getControl("comisionPorcentaje"))?null:i.touched)),o.R7$(),o.Y8G("ngIf",(null==(t=e.getControl("comisionPorcentaje"))?null:t.invalid)&&(null==(t=e.getControl("comisionPorcentaje"))?null:t.touched))}}function Ro(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function Vo(n,r){if(1&n){const i=o.RV6();o.j41(0,"ion-col",10)(1,"ion-input",37),o.bIt("ionBlur",function(){let e;o.eBV(i);const l=o.XpG();return o.Njj(null==(e=l.getControl("cantidadPorcentaje"))?null:e.markAsTouched())}),o.k0s(),o.DNE(2,Ro,2,0,"ion-text",12),o.k0s()}if(2&n){let i,t;const e=o.XpG();o.R7$(),o.AVh("invalid",(null==(i=e.getControl("cantidadPorcentaje"))?null:i.invalid)&&(null==(i=e.getControl("cantidadPorcentaje"))?null:i.touched)),o.R7$(),o.Y8G("ngIf",(null==(t=e.getControl("cantidadPorcentaje"))?null:t.invalid)&&(null==(t=e.getControl("cantidadPorcentaje"))?null:t.touched))}}function Go(n,r){if(1&n&&(o.j41(0,"ion-select-option",34),o.EFF(1),o.k0s()),2&n){const i=r.$implicit;o.Y8G("value",i.valor),o.R7$(),o.SpI(" ",i.nombre," ")}}function So(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function Mo(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function xo(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function Ao(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function Yo(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function Uo(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}function Xo(n,r){1&n&&(o.j41(0,"ion-text",32),o.EFF(1," Campo requerido "),o.k0s())}let zo=(()=>{var n;class r{constructor(t,e,l,s,a,d,p,_){this.fb=t,this.toastController=e,this.loadingCtrl=l,this.empresasService=s,this.productoService=a,this.usuarioService=d,this.cdr=p,this.modalCtrl=_,this.btnName="AGREGAR",this.title="AGREGAR",this.formEnviado=!1,this.tiposComision=[],this.id=void 0,this.TipoComisionEnum=v,this.empresas=[],this.mostrarEmpresas=!1,this.empresaID=0,this.formulario=this.fb.group({nombre:["",[m.k0.required,(0,fo.a)()]],descripcion:[""],fechaVencimiento:["",m.k0.required],empresa:[""],tipoComision:["",m.k0.required],comisionCantidad:[""],comisionPorcentaje:[""],cantidadPorcentaje:[""],otroTipoComision:["",m.k0.required],nivel_1:["",m.k0.required],nivel_2:["",m.k0.required],nivel_3:["",m.k0.required],nivel_4:["",m.k0.required],nivel_master:["",m.k0.required],nivel_base:["",m.k0.required]})}ngOnInit(){var t=this;return(0,x.A)(function*(){t.tiposComision=function mo(){return Object.keys(v).filter(n=>isNaN(Number(n))).map(n=>({nombre:co[n],valor:v[n]}))}();const e=yield t.loadingCtrl.create({message:"Cargando datos..."});yield e.present();try{var l,s;const a=yield(0,C._)(t.empresasService.getAllEmpresas());t.empresas=(null==a?void 0:a.data)||[];const d=yield(0,C._)(t.usuarioService.getUsuario()),p=null==d?void 0:d.data;if(t.rolUser=null===(l=p.roles)||void 0===l?void 0:l.enumValue,(null===(s=p.roles)||void 0===s?void 0:s.enumValue)==h.$u.Admin){t.mostrarEmpresas=!0;const _=t.formulario.get("empresa");null==_||_.setValidators([m.k0.required]),null==_||_.updateValueAndValidity(),t.cdr.detectChanges()}else{const _=yield(0,C._)(t.usuarioService.getEmpresaByUsuario(p.id));t.empresaID=null==_?void 0:_.data.id}}catch(a){console.error("Error al cargar datos",a)}finally{e.dismiss()}})()}enviarFormulario(){if(this.formEnviado)return;if(this.formEnviado=!0,this.formulario.invalid)return this.formulario.markAllAsTouched(),void(this.formEnviado=!1);if(this.formulario.controls.fechaVencimiento.value<new Date)return this.toastController.create({message:"Fecha de vencimiento tiene que ser superior a la actual.",duration:3e3,color:"warning",position:"top"}).then(a=>a.present()),void(this.formEnviado=!1);const l=this.rolUser==h.$u.Admin?this.formulario.controls.empresa.value:this.empresaID;var s={nombre:(0,W.H)(this.formulario.controls.nombre.value),descripcion:(0,W.H)(this.formulario.controls.descripcion.value),empresaID:l,tipoComisionNivel:this.formulario.controls.otroTipoComision.value,comisionCantidad:""==this.formulario.controls.comisionCantidad.value?void 0:this.formulario.controls.comisionCantidad.value,comisionPorcentaje:""==this.formulario.controls.comisionPorcentaje.value?void 0:this.formulario.controls.comisionPorcentaje.value,comisionPorcentajeCantidad:""==this.formulario.controls.cantidadPorcentaje.value?void 0:this.formulario.controls.cantidadPorcentaje.value,fechaCaducidad:this.formulario.controls.fechaVencimiento.value,nivel1:this.formulario.controls.nivel_1.value,nivel2:this.formulario.controls.nivel_2.value,nivel3:this.formulario.controls.nivel_3.value,nivel4:this.formulario.controls.nivel_4.value,nivelBase:this.formulario.controls.nivel_base.value,nivelMaster:this.formulario.controls.nivel_master.value,tipoComision:this.formulario.controls.tipoComision.value,precio:0};this.productoService.save(s).pipe((0,uo.j)(()=>{this.formEnviado=!1})).subscribe({next:a=>{a&&(this.toastController.create({message:"producto guardado.",duration:3e3,color:"success",position:"top"}).then(d=>d.present()),this.modalCtrl.dismiss(!0))}})}getControl(t){return this.formulario.get(t)}close(){this.modalCtrl.dismiss()}onTipoComisionChange(t){const e=t.detail.value,l=this.formulario.get("comisionCantidad"),s=this.formulario.get("comisionPorcentaje"),a=this.formulario.get("cantidadPorcentaje");switch(e){case v.CantidadFija:null==l||l.setValidators([m.k0.required]),null==s||s.clearValidators(),null==s||s.setValue(""),null==a||a.clearValidators(),null==a||a.setValue("");break;case v.Porcentaje:null==s||s.setValidators([m.k0.required]),null==a||a.setValidators([m.k0.required]),null==l||l.clearValidators(),null==l||l.setValue("")}null==l||l.updateValueAndValidity(),null==s||s.updateValueAndValidity(),null==s||s.updateValueAndValidity()}}return(n=r).\u0275fac=function(t){return new(t||n)(o.rXU(m.ok),o.rXU(u.K_),o.rXU(u.Xi),o.rXU(J.z),o.rXU(K),o.rXU(oo.o),o.rXU(o.gRc),o.rXU(u.W3))},n.\u0275cmp=o.VBU({type:n,selectors:[["app-modal",8,"producto","form"]],inputs:{id:"id"},features:[o.Jv_([(0,_o.aw)()])],attrs:ho,decls:74,vars:48,consts:[["picker",""],[1,"modalHeader"],["slot","end"],[3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[1,"modalform-title","ion-text-center"],[1,"modalform",3,"formGroup"],["size","12"],["color","primary"],["size","12","size-md","6"],["label-placement","floating","label","Nombre","formControlName","nombre","placeholder","Nombre(s)","type","text",1,"inputForm",3,"ionBlur"],["color","danger",4,"ngIf"],["label-placement","floating","label","Descripci\xf3n","formControlName","descripcion","placeholder","Descripci\xf3n","type","text","formControlName","descripcion",1,"inputForm"],["appearance","fill",1,"custom-datepicker"],["matInput","","formControlName","fechaVencimiento",3,"matDatepicker"],["matIconSuffix","",3,"for"],["touchUi",""],["size","12","size-md","6",4,"ngIf"],["size","12",1,"ion-margin-top"],["okText","Ok","cancelText","Cancelar","label-placement","floating","label","Tipo de comision","formControlName","tipoComision",1,"inputForm",3,"ionChange","ionBlur","interfaceOptions"],[3,"value",4,"ngFor","ngForOf"],["size","12","size-md","12"],["okText","Ok","cancelText","Cancelar","label-placement","floating","label","Tipo de comision por nivel","formControlName","otroTipoComision",1,"inputForm",3,"ionBlur","interfaceOptions"],["label-placement","floating","label","Nivel 1","formControlName","nivel_1","placeholder","Nivel 1","type","number","min","0",1,"inputForm",3,"ionBlur"],["label-placement","floating","label","Nivel 2","formControlName","nivel_2","placeholder","Nivel 2","type","number","min","0",1,"inputForm",3,"ionBlur"],["label-placement","floating","label","Nivel 3","formControlName","nivel_3","placeholder","Nivel 3","type","number","min","0",1,"inputForm",3,"ionBlur"],["label-placement","floating","label","Nivel 4","formControlName","nivel_4","placeholder","Nivel 4","type","number","min","0",1,"inputForm",3,"ionBlur"],["label-placement","floating","label","Nivel Master","formControlName","nivel_master","placeholder","Nivel Master","type","number","min","0",1,"inputForm",3,"ionBlur"],["label-placement","floating","label","Nivel Base","formControlName","nivel_base","placeholder","Nivel Base","type","number","min","0",1,"inputForm",3,"ionBlur"],[2,"width","100%","text-align","center"],["shape","round",1,"customButton",3,"click","disabled"],["color","danger"],["okText","Ok","cancelText","Cancelar","label-placement","floating","label","Empresa","formControlName","empresa",1,"inputForm",3,"ionBlur","interfaceOptions"],[3,"value"],["label-placement","floating","label","Comisi\xf3n cantidad $","formControlName","comisionCantidad","placeholder","Comisi\xf3n cantidad $","type","number","min","0",1,"inputForm",3,"ionBlur"],["label-placement","floating","label","Comisi\xf3n porcentaje %","formControlName","comisionPorcentaje","placeholder","Comisi\xf3n porcentaje %","type","number","min","0","max","100",1,"inputForm",3,"ionBlur"],["label-placement","floating","label","Cantidad de porcentaje $","formControlName","cantidadPorcentaje","placeholder","Cantidad de porcentaje $","type","number","min","0",1,"inputForm",3,"ionBlur"]],template:function(t,e){if(1&t){const l=o.RV6();o.j41(0,"ion-header",1)(1,"ion-buttons",2)(2,"ion-button",3),o.bIt("click",function(){return o.eBV(l),o.Njj(e.close())}),o.nrm(3,"ion-icon",4),o.k0s()()(),o.j41(4,"ion-content",5)(5,"h2",6),o.EFF(6),o.k0s(),o.j41(7,"form",7)(8,"ion-grid")(9,"ion-row")(10,"ion-col",8)(11,"ion-text",9)(12,"h2"),o.EFF(13,"Datos B\xe1sicos"),o.k0s()()(),o.j41(14,"ion-col",10)(15,"ion-input",11),o.bIt("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("nombre"))?null:a.markAsTouched())}),o.k0s(),o.DNE(16,Po,2,0,"ion-text",12),o.k0s(),o.j41(17,"ion-col",10),o.nrm(18,"ion-input",13),o.DNE(19,jo,2,0,"ion-text",12),o.k0s(),o.j41(20,"ion-col",10)(21,"mat-form-field",14)(22,"mat-label"),o.EFF(23,"Fecha de vencimiento"),o.k0s(),o.nrm(24,"input",15),o.j41(25,"mat-hint"),o.EFF(26,"DD/MM/YYYY"),o.k0s(),o.nrm(27,"mat-datepicker-toggle",16)(28,"mat-datepicker",17,0),o.k0s(),o.DNE(30,bo,2,0,"ion-text",12),o.k0s(),o.DNE(31,ko,4,6,"ion-col",18),o.j41(32,"ion-col",19)(33,"ion-text",9)(34,"h2"),o.EFF(35,"Comisi\xf3n"),o.k0s()()(),o.j41(36,"ion-col",10)(37,"ion-select",20),o.bIt("ionChange",function(a){return o.eBV(l),o.Njj(e.onTipoComisionChange(a))})("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("tipoComision"))?null:a.markAsTouched())}),o.DNE(38,Bo,2,2,"ion-select-option",21),o.k0s(),o.DNE(39,No,2,0,"ion-text",12),o.k0s(),o.DNE(40,Io,3,3,"ion-col",18)(41,yo,3,3,"ion-col",18)(42,Vo,3,3,"ion-col",18),o.j41(43,"ion-col",19)(44,"ion-text",9)(45,"h2"),o.EFF(46,"Niveles"),o.k0s()()(),o.j41(47,"ion-col",22)(48,"ion-select",23),o.bIt("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("otroTipoComision"))?null:a.markAsTouched())}),o.DNE(49,Go,2,2,"ion-select-option",21),o.k0s(),o.DNE(50,So,2,0,"ion-text",12),o.k0s(),o.j41(51,"ion-col",10)(52,"ion-input",24),o.bIt("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("nivel_1"))?null:a.markAsTouched())}),o.k0s(),o.DNE(53,Mo,2,0,"ion-text",12),o.k0s(),o.j41(54,"ion-col",10)(55,"ion-input",25),o.bIt("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("nivel_2"))?null:a.markAsTouched())}),o.k0s(),o.DNE(56,xo,2,0,"ion-text",12),o.k0s(),o.j41(57,"ion-col",10)(58,"ion-input",26),o.bIt("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("nivel_3"))?null:a.markAsTouched())}),o.k0s(),o.DNE(59,Ao,2,0,"ion-text",12),o.k0s(),o.j41(60,"ion-col",10)(61,"ion-input",27),o.bIt("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("nivel_4"))?null:a.markAsTouched())}),o.k0s(),o.DNE(62,Yo,2,0,"ion-text",12),o.k0s(),o.j41(63,"ion-col",10)(64,"ion-input",28),o.bIt("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("nivel_master"))?null:a.markAsTouched())}),o.k0s(),o.DNE(65,Uo,2,0,"ion-text",12),o.k0s(),o.j41(66,"ion-col",10)(67,"ion-input",29),o.bIt("ionBlur",function(){let a;return o.eBV(l),o.Njj(null==(a=e.getControl("nivel_base"))?null:a.markAsTouched())}),o.k0s(),o.DNE(68,Xo,2,0,"ion-text",12),o.k0s()()()()(),o.j41(69,"ion-footer")(70,"ion-toolbar")(71,"div",30)(72,"ion-button",31),o.bIt("click",function(){return o.eBV(l),o.Njj(e.enviarFormulario())}),o.EFF(73),o.k0s()()()()}if(2&t){let l,s,a,d,p,_,b,to,no,io,T,E,k,B,N,D,I,$,y,R,V,G,S,M;const lo=o.sdS(29);o.R7$(4),o.Y8G("fullscreen",!1),o.R7$(2),o.SpI("",e.title," PRODUCTO"),o.R7$(),o.Y8G("formGroup",e.formulario),o.R7$(8),o.AVh("invalid",(null==(l=e.getControl("nombre"))?null:l.invalid)&&(null==(l=e.getControl("nombre"))?null:l.touched)),o.R7$(),o.Y8G("ngIf",(null==(s=e.getControl("nombre"))?null:s.invalid)&&(null==(s=e.getControl("nombre"))?null:s.touched)),o.R7$(2),o.AVh("invalid",(null==(a=e.getControl("descripcion"))?null:a.invalid)&&(null==(a=e.getControl("descripcion"))?null:a.touched)),o.R7$(),o.Y8G("ngIf",(null==(d=e.getControl("descripcion"))?null:d.invalid)&&(null==(d=e.getControl("descripcion"))?null:d.touched)),o.R7$(5),o.Y8G("matDatepicker",lo),o.R7$(3),o.Y8G("for",lo),o.R7$(3),o.Y8G("ngIf",(null==(p=e.getControl("fechaVencimiento"))?null:p.invalid)&&(null==(p=e.getControl("fechaVencimiento"))?null:p.touched)),o.R7$(),o.Y8G("ngIf",e.mostrarEmpresas),o.R7$(6),o.AVh("invalid",(null==(_=e.getControl("tipoComision"))?null:_.invalid)&&(null==(_=e.getControl("tipoComision"))?null:_.touched)),o.Y8G("interfaceOptions",o.lJ4(46,Co)),o.R7$(),o.Y8G("ngForOf",e.tiposComision),o.R7$(),o.Y8G("ngIf",(null==(b=e.getControl("tipoComision"))?null:b.invalid)&&(null==(b=e.getControl("tipoComision"))?null:b.touched)),o.R7$(),o.Y8G("ngIf",(null==(to=e.getControl("tipoComision"))?null:to.value)===e.TipoComisionEnum.CantidadFija),o.R7$(),o.Y8G("ngIf",(null==(no=e.getControl("tipoComision"))?null:no.value)===e.TipoComisionEnum.Porcentaje),o.R7$(),o.Y8G("ngIf",(null==(io=e.getControl("tipoComision"))?null:io.value)===e.TipoComisionEnum.Porcentaje),o.R7$(6),o.AVh("invalid",(null==(T=e.getControl("otroTipoComision"))?null:T.invalid)&&(null==(T=e.getControl("otroTipoComision"))?null:T.touched)),o.Y8G("interfaceOptions",o.lJ4(47,vo)),o.R7$(),o.Y8G("ngForOf",e.tiposComision),o.R7$(),o.Y8G("ngIf",(null==(E=e.getControl("otroTipoComision"))?null:E.invalid)&&(null==(E=e.getControl("otroTipoComision"))?null:E.touched)),o.R7$(2),o.AVh("invalid",(null==(k=e.getControl("nivel_1"))?null:k.invalid)&&(null==(k=e.getControl("nivel_1"))?null:k.touched)),o.R7$(),o.Y8G("ngIf",(null==(B=e.getControl("nivel_1"))?null:B.invalid)&&(null==(B=e.getControl("nivel_1"))?null:B.touched)),o.R7$(2),o.AVh("invalid",(null==(N=e.getControl("nivel_2"))?null:N.invalid)&&(null==(N=e.getControl("nivel_2"))?null:N.touched)),o.R7$(),o.Y8G("ngIf",(null==(D=e.getControl("nivel_2"))?null:D.invalid)&&(null==(D=e.getControl("nivel_2"))?null:D.touched)),o.R7$(2),o.AVh("invalid",(null==(I=e.getControl("nivel_3"))?null:I.invalid)&&(null==(I=e.getControl("nivel_3"))?null:I.touched)),o.R7$(),o.Y8G("ngIf",(null==($=e.getControl("nivel_3"))?null:$.invalid)&&(null==($=e.getControl("nivel_3"))?null:$.touched)),o.R7$(2),o.AVh("invalid",(null==(y=e.getControl("nivel_4"))?null:y.invalid)&&(null==(y=e.getControl("nivel_4"))?null:y.touched)),o.R7$(),o.Y8G("ngIf",(null==(R=e.getControl("nivel_4"))?null:R.invalid)&&(null==(R=e.getControl("nivel_4"))?null:R.touched)),o.R7$(2),o.AVh("invalid",(null==(V=e.getControl("nivel_master"))?null:V.invalid)&&(null==(V=e.getControl("nivel_master"))?null:V.touched)),o.R7$(),o.Y8G("ngIf",(null==(G=e.getControl("nivel_master"))?null:G.invalid)&&(null==(G=e.getControl("nivel_master"))?null:G.touched)),o.R7$(2),o.AVh("invalid",(null==(S=e.getControl("nivel_base"))?null:S.invalid)&&(null==(S=e.getControl("nivel_base"))?null:S.touched)),o.R7$(),o.Y8G("ngIf",(null==(M=e.getControl("nivel_base"))?null:M.invalid)&&(null==(M=e.getControl("nivel_base"))?null:M.touched)),o.R7$(4),o.Y8G("disabled",e.formEnviado),o.R7$(),o.SpI(" ",e.btnName," ")}},dependencies:[u.bv,u.Jm,u.QW,u.hU,u.W9,u.M0,u.lO,u.eU,u.iq,u.$w,u.ln,u.Nm,u.Ip,u.IO,u.ai,u.su,u.Je,u.Gw,u.T6,u.jL,m.X1,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,g.MD,g.Sq,g.bT,po.M,j.j,j.M,j.c,j.g,L.fS,L.fg,P.X6,P.Vh,P.bZ,P.bU],encapsulation:2,changeDetection:0}),r})();var Oo=c(6897),qo=c(2101),eo=c(2490);const wo=()=>[20,50,100];function Qo(n,r){if(1&n){const i=o.RV6();o.j41(0,"ion-col",11)(1,"ion-item",12)(2,"ion-label",13),o.EFF(3,"Filtro por grupo"),o.k0s(),o.j41(4,"ionic-selectable",35),o.bIt("onChange",function(e){o.eBV(i);const l=o.XpG();return o.Njj(l.onGrupoSelect(e))})("onClear",function(e){o.eBV(i);const l=o.XpG();return o.Njj(l.onGrupoClear(e))}),o.k0s()()()}if(2&n){const i=o.XpG();o.R7$(4),o.Y8G("items",i.grupos)("canSearch",!0)("canClear",!0)}}function Ho(n,r){if(1&n){const i=o.RV6();o.j41(0,"ion-col",11)(1,"ion-item",12)(2,"ion-label",13),o.EFF(3,"Filtro por empresa"),o.k0s(),o.j41(4,"ionic-selectable",36),o.bIt("onChange",function(e){o.eBV(i);const l=o.XpG();return o.Njj(l.onEmpresaSelect(e))})("onClear",function(e){o.eBV(i);const l=o.XpG();return o.Njj(l.onEmpresaClear(e))}),o.k0s()()()}if(2&n){const i=o.XpG();o.R7$(4),o.Y8G("items",i.empresas)("canSearch",!0)("canClear",!0)}}function Lo(n,r){1&n&&(o.j41(0,"th",37),o.EFF(1," Nombre/Descripci\xf3n "),o.k0s())}function Wo(n,r){if(1&n&&(o.j41(0,"td",38),o.EFF(1),o.k0s()),2&n){const i=r.$implicit;o.R7$(),o.SpI(" ",i.nombre," ")}}function Jo(n,r){1&n&&(o.j41(0,"th",37),o.EFF(1," Empresa "),o.k0s())}function Zo(n,r){if(1&n&&(o.j41(0,"td",38),o.EFF(1),o.k0s()),2&n){const i=r.$implicit;o.R7$(),o.SpI(" ",i.empresaRazonSocial," ")}}function Ko(n,r){1&n&&(o.j41(0,"th",37),o.EFF(1," Grupo "),o.k0s())}function oe(n,r){1&n&&(o.j41(0,"span"),o.EFF(1,", "),o.k0s())}function ee(n,r){if(1&n&&(o.j41(0,"span"),o.EFF(1),o.DNE(2,oe,2,0,"span",41),o.k0s()),2&n){const i=r.$implicit,t=r.last;o.R7$(),o.SpI(" ",i.nombre,""),o.R7$(),o.Y8G("ngIf",!t)}}function te(n,r){if(1&n&&(o.j41(0,"td",39),o.DNE(1,ee,3,2,"span",40),o.k0s()),2&n){const i=r.$implicit;o.R7$(),o.Y8G("ngForOf",i.grupos)}}function ne(n,r){1&n&&(o.j41(0,"th",42),o.EFF(1," Comision $ "),o.k0s())}function ie(n,r){if(1&n&&(o.j41(0,"td",39),o.EFF(1),o.nI1(2,"currency"),o.k0s()),2&n){const i=r.$implicit;o.R7$(),o.SpI(" ",0===i.comisionCantidad||null==i.comisionCantidad?"No aplica":o.ii3(2,1,i.comisionCantidad,"MXN","symbol","1.2-2")+" MXN"," ")}}function le(n,r){1&n&&(o.j41(0,"th",42),o.EFF(1," Comision % "),o.k0s())}function re(n,r){if(1&n&&(o.j41(0,"td",39),o.EFF(1),o.nI1(2,"currency"),o.k0s()),2&n){const i=r.$implicit;o.R7$(),o.SpI(" ",0===i.comisionPorcentaje||null==i.comisionPorcentaje?"No aplica":o.ii3(2,1,i.comisionPorcentaje,"MXN","symbol","1.2-2")+" %"," ")}}function ae(n,r){1&n&&(o.j41(0,"th",42),o.EFF(1," Valor del % "),o.k0s())}function se(n,r){if(1&n&&(o.j41(0,"td",39),o.EFF(1),o.nI1(2,"currency"),o.k0s()),2&n){const i=r.$implicit;o.R7$(),o.SpI(" ",0===i.comisionPorcentajeCantidad||null==i.comisionPorcentajeCantidad?"No aplica":o.ii3(2,1,i.comisionPorcentajeCantidad,"MXN","symbol","1.2-2")," ")}}function ue(n,r){1&n&&(o.j41(0,"th",42),o.EFF(1," Caducidad "),o.k0s())}function ce(n,r){if(1&n&&(o.j41(0,"td",39),o.EFF(1),o.j41(2,"div")(3,"small",43),o.EFF(4),o.k0s()()()),2&n){const i=r.$implicit,t=o.XpG();o.R7$(),o.SpI(" ",t.formatFecha(i.fechaCaducidad)," "),o.R7$(2),o.Y8G("ngClass",t.getVigencia(i.fechaCaducidad)?"text-success":"text-danger"),o.R7$(),o.SpI(" ",t.getVigencia(i.fechaCaducidad)?"Vigente":"No vigente"," ")}}function de(n,r){1&n&&o.nrm(0,"tr",44)}function me(n,r){1&n&&o.nrm(0,"tr",45)}function pe(n,r){if(1&n&&(o.j41(0,"tr",46)(1,"td",47),o.EFF(2," No se encontraron registros disponibles. "),o.k0s()()),2&n){const i=o.XpG();o.R7$(),o.BMQ("colspan",i.displayedColumns.length)}}const _e=[{path:"",component:(()=>{var n;class r{constructor(t,e,l,s,a,d,p){this.productoService=t,this.loadingCtrl=e,this.empresasService=l,this.grupoService=s,this.usuarioService=a,this.modalCtrl=d,this.route=p,this.dataSourceTable=new f.I6,this.displayedColumns=[],this.allColumns=["Nombre","ComisionCantidad","ComisionPorcentaje","ComisionPorcentajeCantidad","FechaCaducidad"],this.inputBuscar=new X.B,this.query="",this.empresaID=0,this.userid=0,this.inputBusquedaText="Buscar por nombre de producto",this.RolesEnum=h.$u,this.grupos=[],this.empresas=[],this.filterEmpresID=0,this.filterGrupoID=0,this.filterVigencia=0,this.vigencia=[{nombre:"Vigentes",valor:1},{nombre:"No vigentes",valor:2}],this.destroy$=new X.B}ngAfterViewInit(){}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnInit(){var t=this;return(0,x.A)(function*(){var e;let s=t.route.snapshot.data.resolverData.usuario;if(t.rolUsuario=null===(e=s.roles)||void 0===e?void 0:e.enumValue,t.userid=s.id,t.displayedColumns=[...t.allColumns],t.rolUsuario===h.$u.Admin){const p=t.displayedColumns.indexOf("Nombre");-1!==p&&(t.displayedColumns.splice(p+1,0,"Empresa"),t.displayedColumns.splice(p+2,0,"Grupo")),t.inputBusquedaText="Buscar por nombre de producto, empresa o grupo"}const a=yield t.loadingCtrl.create({message:"Cargando datos..."});yield a.present();try{if(t.rolUsuario==h.$u.Socio){const d=yield(0,C._)(t.usuarioService.getEmpresaByUsuario(t.userid));t.empresaID=d.data.id}else{const d=yield(0,C._)(t.empresasService.getAllEmpresas());t.empresas=(null==d?void 0:d.data)||[];const p=yield(0,C._)(t.grupoService.getAllGrupos());t.grupos=(null==p?void 0:p.data)||[]}t.dataSourceTable.paginator=t.paginator,t.loadtable()}catch(d){console.error("Error al cargar datos",d)}finally{a.dismiss()}t.inputBuscar.pipe((0,ro.B)(1e3),(0,ao.F)(),(0,so.Q)(t.destroy$)).subscribe(d=>{t.query=d.toString(),t.loadtable()})})()}loadtable(){switch(this.rolUsuario){case h.$u.Admin:this.loadtableAll();break;case h.$u.Socio:this.loadtableByEmpresa()}}loadtableAll(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,z.h)(this.sort.sortChange,this.paginator.page).pipe((0,O.Z)({}),(0,q.n)(()=>this.productoService.getProductoAllPaginated({page:this.paginator.pageIndex,size:this.paginator.pageSize,sortBy:this.sort.active,sortDir:this.sort.direction,searchQuery:this.query,grupoID:this.filterGrupoID,empresaID:this.filterEmpresID,vigenciaFilter:this.filterVigencia}).pipe((0,w.W)(()=>(0,Q.of)(null)))),(0,H.T)(t=>null===t?[]:(this.total=t.data.total,t.data.items))).subscribe(t=>{this.dataSourceTable=new f.I6(t)})}loadtableByEmpresa(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,z.h)(this.sort.sortChange,this.paginator.page).pipe((0,O.Z)({}),(0,q.n)(()=>this.productoService.getProductoByEmpresaPaginated({id:this.empresaID,page:this.paginator.pageIndex,size:this.paginator.pageSize,sortBy:this.sort.active,sortDir:this.sort.direction,searchQuery:this.query,vigenciaFilter:this.filterVigencia}).pipe((0,w.W)(()=>(0,Q.of)(null)))),(0,H.T)(t=>null===t?[]:(this.total=t.data.total,t.data.items))).subscribe(t=>{this.dataSourceTable=new f.I6(t)})}addModal(){var t=this;return(0,x.A)(function*(){const e=yield t.modalCtrl.create({component:zo,cssClass:"modal-empresa"});yield e.present();const{data:l}=yield e.onDidDismiss();l&&(console.log(l),t.loadtable())})()}onGrupoSelect(t){null!=t.value&&null!=t.value&&(this.filterGrupoID=t.value.id,this.loadtable())}onGrupoClear(t){this.filterGrupoID=0,this.loadtable()}onEmpresaSelect(t){null!=t.value&&null!=t.value&&(this.filterEmpresID=t.value.id,this.loadtable())}onEmpresaClear(t){this.filterEmpresID=0,this.loadtable()}onVigenciaSelect(t){null!=t.value&&(this.filterVigencia=t.value.valor,this.loadtable())}onVigenciaClear(t){this.filterVigencia=0,this.loadtable()}formatFecha(t){if(null==t)return"No aplica";const e=new Date(t),l=e.getDate().toString().padStart(2,"0");let s=e.toLocaleString("es-MX",{month:"long"});return s=s.charAt(0).toUpperCase()+s.slice(1),`${l} ${s} ${e.getFullYear()}`}getVigencia(t){if(null==t)return!0;const e=new Date;e.setHours(0,0,0,0);const l=new Date(t);return l.setHours(0,0,0,0),l>=e}}return(n=r).\u0275fac=function(t){return new(t||n)(o.rXU(K),o.rXU(u.Xi),o.rXU(J.z),o.rXU(Oo.b),o.rXU(oo.o),o.rXU(u.W3),o.rXU(qo.nX))},n.\u0275cmp=o.VBU({type:n,selectors:[["app-productos"]],viewQuery:function(t,e){if(1&t&&(o.GBs(A.iy,5),o.GBs(F.B4,5)),2&t){let l;o.mGM(l=o.lsd())&&(e.paginator=l.first),o.mGM(l=o.lsd())&&(e.sort=l.first)}},standalone:!1,decls:59,vars:14,consts:[[1,"pagesHeader"],["slot","start"],["name","archive","color","white"],[1,"pagesContent"],[1,"ion-align-items-center"],["size","12","size-md","9",1,"ion-text-center"],[1,"inputBusqueda",3,"ionInput","placeholder"],["slot","end","name","search","aria-hidden","true"],["size","12","size-md","2",1,"ion-text-center"],["expand","block","shape","round",1,"customGreenButton",3,"click"],["name","add","color","white"],["size","12","size-md","4",1,"ion-text-center"],[1,"inputBusqueda"],["position","floating"],["item-content","","itemValueField","valor","closeButtonSlot","end","itemTextField","nombre","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],["size","12","size-md","4","class","ion-text-center",4,"ngIf"],[1,"referidosHeader"],[1,"title"],[2,"overflow-x","auto"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","Nombre"],["mat-header-cell","","style","padding-left: 1rem;","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","style","padding-left: 1rem;",4,"matCellDef"],["matColumnDef","Empresa"],["matColumnDef","Grupo"],["mat-cell","",4,"matCellDef"],["matColumnDef","ComisionCantidad"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","ComisionPorcentaje"],["matColumnDef","ComisionPorcentajeCantidad"],["matColumnDef","FechaCaducidad"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","mydivoutermulti elemento-renglon",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"length","pageSizeOptions","pageSize"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","nombre","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","razonSocial","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],["mat-header-cell","","mat-sort-header","",2,"padding-left","1rem"],["mat-cell","",2,"padding-left","1rem"],["mat-cell",""],[4,"ngFor","ngForOf"],[4,"ngIf"],["mat-header-cell","","mat-sort-header",""],[3,"ngClass"],["mat-header-row",""],["mat-row","",1,"mydivoutermulti","elemento-renglon"],[1,"mat-row"],[2,"text-align","center","padding","1rem"]],template:function(t,e){1&t&&(o.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),o.nrm(3,"ion-menu-button"),o.k0s(),o.j41(4,"ion-title")(5,"h1"),o.nrm(6,"ion-icon",2),o.EFF(7," Productos a promocionar"),o.k0s()()()(),o.j41(8,"ion-content",3)(9,"div")(10,"ion-grid")(11,"ion-row",4)(12,"ion-col",5)(13,"ion-input",6),o.bIt("ionInput",function(s){return e.inputBuscar.next(s.detail.value||"")}),o.nrm(14,"ion-icon",7),o.k0s()(),o.j41(15,"ion-col",8)(16,"ion-button",9),o.bIt("click",function(){return e.addModal()}),o.nrm(17,"ion-icon",10),o.EFF(18," AGREGAR"),o.k0s()()(),o.j41(19,"ion-row",4)(20,"ion-col",11)(21,"ion-item",12)(22,"ion-label",13),o.EFF(23,"Filtro por vigencia"),o.k0s(),o.j41(24,"ionic-selectable",14),o.bIt("onChange",function(s){return e.onVigenciaSelect(s)})("onClear",function(s){return e.onVigenciaClear(s)}),o.k0s()()(),o.DNE(25,Qo,5,3,"ion-col",15)(26,Ho,5,3,"ion-col",15),o.k0s()()(),o.j41(27,"ion-card")(28,"ion-card-header",16)(29,"ion-card-title",17),o.EFF(30,"Productos"),o.k0s()(),o.j41(31,"ion-card-content")(32,"div",18)(33,"table",19),o.qex(34,20),o.DNE(35,Lo,2,0,"th",21)(36,Wo,2,1,"td",22),o.bVm(),o.qex(37,23),o.DNE(38,Jo,2,0,"th",21)(39,Zo,2,1,"td",22),o.bVm(),o.qex(40,24),o.DNE(41,Ko,2,0,"th",21)(42,te,2,1,"td",25),o.bVm(),o.qex(43,26),o.DNE(44,ne,2,0,"th",27)(45,ie,3,6,"td",25),o.bVm(),o.qex(46,28),o.DNE(47,le,2,0,"th",27)(48,re,3,6,"td",25),o.bVm(),o.qex(49,29),o.DNE(50,ae,2,0,"th",27)(51,se,3,6,"td",25),o.bVm(),o.qex(52,30),o.DNE(53,ue,2,0,"th",27)(54,ce,5,3,"td",25),o.bVm(),o.DNE(55,de,1,0,"tr",31)(56,me,1,0,"tr",32)(57,pe,3,1,"tr",33),o.k0s()(),o.nrm(58,"mat-paginator",34),o.k0s()()()),2&t&&(o.R7$(13),o.Y8G("placeholder",e.inputBusquedaText),o.R7$(11),o.Y8G("items",e.vigencia)("canSearch",!0)("canClear",!0),o.R7$(),o.Y8G("ngIf",e.rolUsuario==e.RolesEnum.Admin),o.R7$(),o.Y8G("ngIf",e.rolUsuario==e.RolesEnum.Admin),o.R7$(7),o.Y8G("dataSource",e.dataSourceTable),o.R7$(22),o.Y8G("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),o.R7$(),o.Y8G("matRowDefColumns",e.displayedColumns),o.R7$(2),o.Y8G("length",e.total)("pageSizeOptions",o.lJ4(13,wo))("pageSize",50))},dependencies:[g.YU,g.Sq,g.bT,u.Jm,u.QW,u.b_,u.I9,u.ME,u.tN,u.hU,u.W9,u.lO,u.eU,u.iq,u.$w,u.uz,u.he,u.MC,u.ln,u.BC,u.ai,u.Gw,f.Zl,f.tL,f.ji,f.cC,f.YV,f.iL,f.KS,f.$R,f.YZ,f.NB,f.ky,A.iy,F.B4,F.aE,eo.ec,g.oe],styles:[".text-success[_ngcontent-%COMP%]{color:green}.text-danger[_ngcontent-%COMP%]{color:red}"]}),r})()}];let fe=(()=>{var n;class r{}return(n=r).\u0275fac=function(t){return new(t||n)},n.\u0275mod=o.$C({type:n}),n.\u0275inj=o.G2t({imports:[U.iI.forChild(_e),U.iI]}),r})(),ge=(()=>{var n;class r{}return(n=r).\u0275fac=function(t){return new(t||n)},n.\u0275mod=o.$C({type:n}),n.\u0275inj=o.G2t({imports:[g.MD,m.YN,u.bv,fe,f.tP,A.Ou,F.NQ,eo.ec]}),r})()}}]);