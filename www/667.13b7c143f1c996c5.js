"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[667],{667:(Ye,j,c)=>{c.r(j),c.d(j,{ReferenciasPageModule:()=>Xe});var p=c(2881),d=c(9417),s=c(3092),D=c(9870),C=c(467),b=c(7550),S=c(2042),u=c(3662),v=c(1413),_=c(4843),T=c(152),V=c(3294),M=c(6977),I=c(7786),$=c(9172),y=c(5558),G=c(9437),P=c(7673),B=c(6354),E=function(i){return i[i.Creado=1]="Creado",i[i.Seguimiento=2]="Seguimiento",i[i.Cerrado=3]="Cerrado",i}(E||{});const X={Creado:"Creado",Seguimiento:"Seguimiento",Cerrado:"Cerrado"};function x(){return Object.keys(E).filter(i=>isNaN(Number(i))).map(i=>({nombre:X[i],valor:E[i]}))}var R=c(6231),e=c(1360);const Y=["class","qr view"];function w(i,r){if(1&i&&e.nrm(0,"img",8),2&i){const n=e.XpG();e.Y8G("src",n.imagenBase64,e.B4B)}}let z=(()=>{var i;class r{constructor(t){this.modalCtrl=t,this.imagenBase64=""}ngOnInit(){}close(){this.modalCtrl.dismiss()}}return(i=r).\u0275fac=function(t){return new(t||i)(e.rXU(s.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-modal",8,"qr","view"]],inputs:{imagenBase64:"imagenBase64"},attrs:Y,decls:10,vars:2,consts:[[1,"modalHeader"],["slot","end"],[3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[1,"modalform-title","ion-text-center"],[1,"upload-card"],[3,"src",4,"ngIf"],[3,"src"]],template:function(t,o){1&t&&(e.j41(0,"ion-header",0)(1,"ion-buttons",1)(2,"ion-button",2),e.bIt("click",function(){return o.close()}),e.nrm(3,"ion-icon",3),e.k0s()()(),e.j41(4,"ion-content",4)(5,"h2",5),e.EFF(6," QR"),e.k0s(),e.j41(7,"ion-item")(8,"ion-card",6),e.DNE(9,w,1,1,"img",7),e.k0s()()()),2&t&&(e.R7$(4),e.Y8G("fullscreen",!1),e.R7$(5),e.Y8G("ngIf",o.imagenBase64))},dependencies:[s.bv,s.Jm,s.QW,s.b_,s.W9,s.eU,s.iq,s.uz,d.X1,p.MD,p.bT],encapsulation:2}),r})();var k=c(980),O=c(5460),Q=c(6152),h=c(7643),N=c(5312);let U=(()=>{var i;class r{constructor(t){this.http=t,this.apiUrl=N.c.apiUrl+"api/Referido"}getAllReferidosPaginated(t){let o=(new h.Nl).set("page",t.page.toString()).set("size",t.size.toString()).set("sortBy",t.sortBy).set("sortDir",t.sortDir).set("searchQuery",t.searchQuery||"").set("grupoID",t.grupoID.toString()).set("usuarioID",t.usuarioID.toString()).set("empresaID",t.empresaID.toString());return null!=t.statusEnum&&(o=o.set("estatus",t.statusEnum.toString())),this.http.get(`${this.apiUrl}/GetAllReferidosPaginated`,{params:o})}getReferidosByEmpresaPaginated(t){let o=(new h.Nl).set("empresaID",t.id.toString()).set("page",t.page.toString()).set("size",t.size.toString()).set("sortBy",t.sortBy).set("sortDir",t.sortDir).set("usuarioID",t.usuarioID.toString()).set("searchQuery",t.searchQuery||"");return null!=t.statusEnum&&(o=o.set("estatus",t.statusEnum.toString())),this.http.get(`${this.apiUrl}/GetReferidosByEmpresaPaginated`,{params:o})}getByID(t){let o=(new h.Nl).set("id",t);return this.http.get(`${this.apiUrl}/GetReferidoByID`,{params:o})}updateEstatus(t){return this.http.post(`${this.apiUrl}/UpdateStatus`,t)}getQR(t){let o=(new h.Nl).set("codigo",t);return this.http.get(`${this.apiUrl}/GetQR`,{params:o})}}return(i=r).\u0275fac=function(t){return new(t||i)(e.KVO(h.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),r})(),A=(()=>{var i;class r{constructor(t){this.http=t,this.apiUrl=N.c.apiUrl+"api/SeguimientoReferido"}getSeguimientosReferido(t){let o=(new h.Nl).set("referidoID",t);return this.http.get(`${this.apiUrl}/GetSeguimientoReferido`,{params:o})}save(t){return this.http.post(`${this.apiUrl}/Save`,t)}}return(i=r).\u0275fac=function(t){return new(t||i)(e.KVO(h.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),r})();const W=["class","seguimiento referencia"],H=()=>({header:"Estatus de seguimiento"});function L(i,r){if(1&i&&(e.j41(0,"ion-select-option",16),e.EFF(1),e.k0s()),2&i){const n=r.$implicit,t=e.XpG();e.Y8G("value",n.valor)("disabled",n.valor===t.estatusReferenciaEnum.Creado),e.R7$(),e.SpI(" ",n.nombre," ")}}function J(i,r){1&i&&(e.j41(0,"ion-text",17),e.EFF(1," Campo requerido "),e.k0s())}function q(i,r){1&i&&(e.j41(0,"ion-text",17),e.EFF(1," Campo requerido "),e.k0s())}function K(i,r){if(1&i){const n=e.RV6();e.j41(0,"ion-col",14)(1,"form",8),e.nrm(2,"ion-textarea",18),e.DNE(3,q,2,0,"ion-text",11),e.nrm(4,"br"),e.j41(5,"ion-button",12),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.enviarFormulario())}),e.EFF(6," Enviar seguimiento "),e.k0s()()()}if(2&i){let n,t;const o=e.XpG();e.R7$(),e.Y8G("formGroup",o.formulario),e.R7$(),e.AVh("invalid",(null==(n=o.getControl("comentario"))?null:n.invalid)&&(null==(n=o.getControl("comentario"))?null:n.touched)),e.R7$(),e.Y8G("ngIf",(null==(t=o.getControl("comentario"))?null:t.invalid)&&(null==(t=o.getControl("comentario"))?null:t.touched)),e.R7$(2),e.Y8G("disabled",o.formEnviado)}}function Z(i,r){if(1&i&&(e.j41(0,"ion-card",19)(1,"ion-card-header")(2,"ion-card-subtitle"),e.EFF(3),e.k0s()(),e.j41(4,"ion-card-content")(5,"p"),e.EFF(6),e.k0s()()()),2&i){const n=r.$implicit,t=e.XpG();e.R7$(3),e.JRh(t.formatFecha(n.fechaSeguimiento)),e.R7$(3),e.JRh(n.comentario)}}let ee=(()=>{var i;class r{constructor(t,o,a,l,f,m){this.fb=t,this.modalCtrl=o,this.toastController=a,this.loadingCtrl=l,this.referidoService=f,this.seguimientoReferidoService=m,this.formEnviado=!1,this.numSeguimientos=0,this.seguimientos=[],this.estatus=[],this.estatusReferenciaEnum=E,this.id=void 0,this.formulario=this.fb.group({comentario:["",[d.k0.required,(0,O.a)()]]}),this.formStatus=this.fb.group({status:["",d.k0.required]})}ngOnInit(){var t=this;return(0,C.A)(function*(){t.estatus=x();const o=yield t.loadingCtrl.create({message:"Cargando datos..."});yield o.present();try{const a=yield(0,_._)(t.referidoService.getByID(t.id));t.referido=a.data,t.formStatus.patchValue({status:t.referido.estatusReferenciaEnum}),t.getSeguimientos()}catch(a){console.error("Error al cargar datos",a)}finally{o.dismiss()}})()}getSeguimientos(){this.seguimientoReferidoService.getSeguimientosReferido(this.id).subscribe({next:t=>{this.seguimientos=t.data,this.numSeguimientos=this.seguimientos.length}})}enviarFormularioStatus(){if(!this.formEnviado){if(this.formEnviado=!0,this.formStatus.invalid)return this.formStatus.markAllAsTouched(),void(this.formEnviado=!1);var t={id:this.id,estatusReferenciaEnum:this.formStatus.controls.status.value};this.referidoService.updateEstatus(t).pipe((0,k.j)(()=>{this.formEnviado=!1})).subscribe({next:o=>{o&&(this.toastController.create({message:"Estatus actualizado.",duration:3e3,color:"success",position:"top"}).then(a=>a.present()),this.getSeguimientos(),this.referido.estatusReferenciaEnum=t.estatusReferenciaEnum)}})}}enviarFormulario(){if(!this.formEnviado){if(this.formEnviado=!0,this.formulario.invalid)return this.formulario.markAllAsTouched(),void(this.formEnviado=!1);var t={comentario:(0,Q.H)(this.formulario.controls.comentario.value),referidoID:this.id};this.seguimientoReferidoService.save(t).pipe((0,k.j)(()=>{this.formEnviado=!1})).subscribe({next:o=>{o&&(this.toastController.create({message:"seguimiento guardado.",duration:3e3,color:"success",position:"top"}).then(a=>a.present()),this.getSeguimientos(),this.formulario.reset())}})}}getControl(t){return this.formulario.get(t)}close(){this.modalCtrl.dismiss()}formatFecha(t){const o=new Date(t),a=o.getDate().toString().padStart(2,"0");let l=o.toLocaleString("es-MX",{month:"long"});return l=l.charAt(0).toUpperCase()+l.slice(1),`${a}-${l}-${o.getFullYear()}`}}return(i=r).\u0275fac=function(t){return new(t||i)(e.rXU(d.ok),e.rXU(s.W3),e.rXU(s.K_),e.rXU(s.Xi),e.rXU(U),e.rXU(A))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-modal",8,"seguimiento","referencia"]],inputs:{id:"id"},attrs:W,decls:53,vars:17,consts:[[1,"modalHeader"],["slot","end"],[3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[1,"modalform-title","ion-text-center"],["size","12"],["color","primary"],[3,"formGroup"],["okText","Ok","cancelText","Cancelar","label-placement","floating","label","Estatus seguimiento","formControlName","status",1,"inputForm",3,"ionBlur","interfaceOptions"],[3,"value","disabled",4,"ngFor","ngForOf"],["color","danger",4,"ngIf"],[3,"click","disabled"],["size","12","size-md","12",4,"ngIf"],["size","12","size-md","12"],["color","light",4,"ngFor","ngForOf"],[3,"value","disabled"],["color","danger"],["formControlName","comentario","label-placement","floating","label","Seguimiento","autoGrow","true","rows","4","maxlength","500","placeholder","Escribe tu seguimiento",1,"inputForm"],["color","light"]],template:function(t,o){if(1&t&&(e.j41(0,"ion-header",0)(1,"ion-buttons",1)(2,"ion-button",2),e.bIt("click",function(){return o.close()}),e.nrm(3,"ion-icon",3),e.k0s()()(),e.j41(4,"ion-content",4)(5,"h2",5),e.EFF(6,"Seguimiento de referido"),e.k0s(),e.j41(7,"ion-grid")(8,"ion-row")(9,"ion-col",6)(10,"ion-text",7)(11,"h2"),e.EFF(12,"Referido"),e.k0s()(),e.j41(13,"b"),e.EFF(14,"Nombre:"),e.k0s(),e.EFF(15),e.nrm(16,"br"),e.j41(17,"b"),e.EFF(18,"Email"),e.k0s(),e.EFF(19),e.nrm(20,"br"),e.j41(21,"b"),e.EFF(22,"Celular:"),e.k0s(),e.EFF(23),e.nrm(24,"br"),e.j41(25,"b"),e.EFF(26,"Producto:"),e.k0s(),e.EFF(27),e.nrm(28,"br")(29,"br"),e.j41(30,"h3"),e.EFF(31,"Embajador que realizo la referencia: "),e.k0s(),e.EFF(32),e.k0s()(),e.j41(33,"ion-row")(34,"ion-col",6)(35,"ion-text",7)(36,"h2"),e.EFF(37,"Estatus"),e.k0s()(),e.j41(38,"form",8)(39,"ion-select",9),e.bIt("ionBlur",function(){let l;return null==(l=o.getControl("status"))?null:l.markAsTouched()}),e.DNE(40,L,2,3,"ion-select-option",10),e.k0s(),e.DNE(41,J,2,0,"ion-text",11),e.nrm(42,"br"),e.j41(43,"ion-button",12),e.bIt("click",function(){return o.enviarFormularioStatus()}),e.EFF(44," Actualizar estatus "),e.k0s()()()(),e.j41(45,"ion-row")(46,"ion-col",6)(47,"ion-text",7)(48,"h2"),e.EFF(49),e.k0s()()(),e.DNE(50,K,7,5,"ion-col",13),e.j41(51,"ion-col",14),e.DNE(52,Z,7,2,"ion-card",15),e.k0s()()()()),2&t){let a,l;e.R7$(4),e.Y8G("fullscreen",!1),e.R7$(11),e.SpI(" ",null==o.referido?null:o.referido.nombreCompleto,""),e.R7$(4),e.SpI(" ",null==o.referido?null:o.referido.email,""),e.R7$(4),e.SpI(" ",null==o.referido?null:o.referido.celular,""),e.R7$(4),e.SpI(" ",null==o.referido?null:o.referido.productoNombre,""),e.R7$(5),e.SpI(" ",null==o.referido?null:o.referido.usuarioNombreCompleto," "),e.R7$(6),e.Y8G("formGroup",o.formStatus),e.R7$(),e.AVh("invalid",(null==(a=o.getControl("status"))?null:a.invalid)&&(null==(a=o.getControl("status"))?null:a.touched)),e.Y8G("interfaceOptions",e.lJ4(16,H)),e.R7$(),e.Y8G("ngForOf",o.estatus),e.R7$(),e.Y8G("ngIf",(null==(l=o.getControl("status"))?null:l.invalid)&&(null==(l=o.getControl("status"))?null:l.touched)),e.R7$(2),e.Y8G("disabled",o.formEnviado),e.R7$(6),e.SpI("Seguimientos (",o.numSeguimientos,")"),e.R7$(),e.Y8G("ngIf",(null==o.referido?null:o.referido.estatusReferenciaEnum)==o.estatusReferenciaEnum.Seguimiento),e.R7$(2),e.Y8G("ngForOf",o.seguimientos)}},dependencies:[s.bv,s.Jm,s.QW,s.b_,s.I9,s.ME,s.HW,s.hU,s.W9,s.lO,s.eU,s.iq,s.ln,s.Nm,s.Ip,s.IO,s.nc,s.Je,s.Gw,d.X1,d.qT,d.BC,d.cb,d.tU,d.j4,d.JD,p.MD,p.Sq,p.bT],encapsulation:2}),r})();var te=c(8311),ie=c(6897),oe=c(2101),ne=c(7248),F=c(2490);const re=["selectableComponent"],ae=()=>[20,50,100];function se(i,r){if(1&i){const n=e.RV6();e.j41(0,"ion-col",10)(1,"ion-item",11)(2,"ion-label",12),e.EFF(3,"Filtro por grupo"),e.k0s(),e.j41(4,"ionic-selectable",36),e.bIt("onChange",function(o){e.eBV(n);const a=e.XpG();return e.Njj(a.onGrupoSelect(o))})("onClear",function(o){e.eBV(n);const a=e.XpG();return e.Njj(a.onGrupoClear(o))}),e.k0s()()()}if(2&i){const n=e.XpG();e.R7$(4),e.Y8G("items",n.grupos)("canSearch",!0)("canClear",!0)}}function le(i,r){1&i&&(e.j41(0,"ion-item",39)(1,"p",40),e.EFF(2," Solo se muestran los primeros 30 usuarios encontrados. Si no encuentra el deseado, utilice el buscador para obtener un resultado m\xe1s preciso. "),e.k0s()())}function ce(i,r){if(1&i){const n=e.RV6();e.j41(0,"ion-col",10)(1,"ion-item",11)(2,"ion-label",12),e.EFF(3,"Filtro por embajador"),e.k0s(),e.j41(4,"ionic-selectable",37,0),e.bIt("onSearch",function(o){e.eBV(n);const a=e.XpG();return e.Njj(a.onSearchChange(o))})("onOpen",function(o){e.eBV(n);const a=e.XpG();return e.Njj(a.onOpen(o))})("onChange",function(o){e.eBV(n);const a=e.XpG();return e.Njj(a.onUsuarioSelect(o))})("onClear",function(o){e.eBV(n);const a=e.XpG();return e.Njj(a.onUsuarioClear(o))}),e.DNE(6,le,3,0,"ng-template",38),e.k0s()()()}if(2&i){const n=e.XpG();e.R7$(4),e.Y8G("items",n.usuarios)("searchFailText","No se encontraron usuarios.")("canSearch",!0)("canClear",!0)}}function ue(i,r){if(1&i){const n=e.RV6();e.j41(0,"ion-col",10)(1,"ion-item",11)(2,"ion-label",12),e.EFF(3,"Filtro por empresa"),e.k0s(),e.j41(4,"ionic-selectable",41),e.bIt("onChange",function(o){e.eBV(n);const a=e.XpG();return e.Njj(a.onEmpresaSelect(o))})("onClear",function(o){e.eBV(n);const a=e.XpG();return e.Njj(a.onEmpresaClear(o))}),e.k0s()()()}if(2&i){const n=e.XpG();e.R7$(4),e.Y8G("items",n.empresas)("canSearch",!0)("canClear",!0)}}function me(i,r){1&i&&(e.j41(0,"th",42),e.EFF(1," Nombre "),e.k0s())}function de(i,r){if(1&i&&(e.j41(0,"td",43),e.EFF(1),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.SpI(" ",n.nombre," ")}}function fe(i,r){1&i&&(e.j41(0,"th",42),e.EFF(1," Email "),e.k0s())}function pe(i,r){if(1&i&&(e.j41(0,"td",43),e.EFF(1),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.SpI(" ",n.email," ")}}function ge(i,r){1&i&&(e.j41(0,"th",42),e.EFF(1," Celular "),e.k0s())}function he(i,r){if(1&i&&(e.j41(0,"td",43),e.EFF(1),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.SpI(" ",n.celular," ")}}function _e(i,r){1&i&&(e.j41(0,"th",42),e.EFF(1," Producto "),e.k0s())}function Re(i,r){if(1&i&&(e.j41(0,"div")(1,"small",45),e.EFF(2),e.k0s()()),2&i){const n=e.XpG().$implicit;e.R7$(),e.Y8G("ngClass",n.productoVigente?"text-success":"text-danger"),e.R7$(),e.SpI(" ",n.productoVigente?"Vigente":"No vigente"," ")}}function Ce(i,r){if(1&i&&(e.j41(0,"td",43),e.EFF(1),e.DNE(2,Re,3,2,"div",44),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.SpI(" ",n.producto," "),e.R7$(),e.Y8G("ngIf",null!==n.vigente)}}function Se(i,r){1&i&&(e.j41(0,"th",42),e.EFF(1," Embajador "),e.k0s())}function Ee(i,r){if(1&i&&(e.j41(0,"td",43),e.EFF(1),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.SpI(" ",n.embajador," ")}}function be(i,r){1&i&&(e.j41(0,"th",42),e.EFF(1," Empresa "),e.k0s())}function ve(i,r){if(1&i&&(e.j41(0,"td",43),e.EFF(1),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.SpI(" ",n.empresa," ")}}function Fe(i,r){1&i&&(e.j41(0,"th",42),e.EFF(1," Grupo "),e.k0s())}function je(i,r){1&i&&(e.j41(0,"span"),e.EFF(1,", "),e.k0s())}function De(i,r){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.DNE(2,je,2,0,"span",44),e.k0s()),2&i){const n=r.$implicit,t=r.last;e.R7$(),e.SpI(" ",n.nombre,""),e.R7$(),e.Y8G("ngIf",!t)}}function Te(i,r){if(1&i&&(e.j41(0,"td",46),e.DNE(1,De,3,2,"span",47),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.Y8G("ngForOf",n.grupos)}}function Ie(i,r){1&i&&(e.j41(0,"th",42),e.EFF(1," Estatus Referencia "),e.k0s())}function $e(i,r){if(1&i&&(e.j41(0,"td",43),e.EFF(1),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.SpI(" ",n.estatusRerefencia," ")}}function ye(i,r){1&i&&(e.j41(0,"th",48),e.EFF(1," Cupon "),e.k0s())}function Ge(i,r){if(1&i){const n=e.RV6();e.j41(0,"ion-button",50),e.bIt("click",function(){e.eBV(n);const o=e.XpG().$implicit,a=e.XpG();return e.Njj(a.viewQR(o.codigoCupon))}),e.nrm(1,"ion-icon",51),e.j41(2,"small"),e.EFF(3,"QR"),e.k0s()()}}function Pe(i,r){if(1&i&&(e.j41(0,"td",46),e.DNE(1,Ge,4,0,"ion-button",49),e.k0s()),2&i){const n=r.$implicit;e.R7$(),e.vxM(""!=n.codigoCupon&&null!=n.codigoCupon&&null!=n.codigoCupon?1:-1)}}function Be(i,r){1&i&&(e.j41(0,"th",48),e.EFF(1," Opciones "),e.k0s())}function xe(i,r){if(1&i){const n=e.RV6();e.j41(0,"td",46)(1,"ion-button",50),e.bIt("click",function(){const o=e.eBV(n).$implicit,a=e.XpG();return e.Njj(a.seguimientoModal(o.id))}),e.nrm(2,"ion-icon",52),e.j41(3,"small"),e.EFF(4,"Seguimiento"),e.k0s()()()}}function ke(i,r){1&i&&e.nrm(0,"tr",53)}function Ne(i,r){1&i&&e.nrm(0,"tr",54)}function Ue(i,r){if(1&i&&(e.j41(0,"tr",55)(1,"td",56),e.EFF(2," No se encontraron registros disponibles. "),e.k0s()()),2&i){const n=e.XpG();e.R7$(),e.BMQ("colspan",n.displayedColumns.length)}}const Ve=[{path:"",component:(()=>{var i;class r{constructor(t,o,a,l,f,m,g){this.loadingCtrl=t,this.empresasService=o,this.grupoService=a,this.modalCtrl=l,this.route=f,this.usuarioService=m,this.referidoService=g,this.dataSourceTable=new u.I6,this.displayedColumns=[],this.allColumns=["Nombre","Email","Celular","Producto","Embajador","EstatusReferencia","QR","Visualizar"],this.inputBuscar=new v.B,this.query="",this.empresaID=0,this.userid=0,this.inputBusquedaText="Buscar por nombre, email, celular o producto",this.RolesEnum=R.$u,this.grupos=[],this.empresas=[],this.estatus=[],this.filterEmpresID=0,this.filterGrupoID=0,this.filterEstatusEnum=void 0,this.filterUsuario=0,this.usuarios=[],this.searchSubject=new v.B,this.destroy$=new v.B,this.setupSearch()}ngAfterViewInit(){}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnInit(){var t=this;return(0,C.A)(function*(){var o;let l=t.route.snapshot.data.resolverData.usuario;if(t.rolUsuario=null===(o=l.roles)||void 0===o?void 0:o.enumValue,t.estatus=x(),t.userid=l.id,t.displayedColumns=[...t.allColumns],t.rolUsuario===R.$u.Admin){const g=t.displayedColumns.indexOf("Producto");-1!==g&&(t.displayedColumns.splice(g+1,0,"Empresa"),t.displayedColumns.splice(g+2,0,"Grupo")),t.inputBusquedaText="Buscar por nombre, email, celular, producto, empresa o grupo"}const f=yield t.loadingCtrl.create({message:"Cargando datos..."});yield f.present();try{if(t.rolUsuario==R.$u.Socio){const m=yield(0,_._)(t.usuarioService.getEmpresaByUsuario(t.userid));t.empresaID=m.data.id}else{const m=yield(0,_._)(t.empresasService.getAllEmpresas());t.empresas=(null==m?void 0:m.data)||[];const g=yield(0,_._)(t.grupoService.getAllGrupos());t.grupos=(null==g?void 0:g.data)||[]}t.dataSourceTable.paginator=t.paginator,t.loadtable()}catch(m){console.error("Error al cargar datos",m)}finally{f.dismiss()}t.inputBuscar.pipe((0,T.B)(1e3),(0,V.F)(),(0,M.Q)(t.destroy$)).subscribe(m=>{t.query=m.toString(),t.loadtable()})})()}loadtable(){switch(this.rolUsuario){case R.$u.Admin:this.loadtableAll();break;case R.$u.Socio:this.loadtableByEmpresa()}}loadtableAll(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,I.h)(this.sort.sortChange,this.paginator.page).pipe((0,$.Z)({}),(0,y.n)(()=>this.referidoService.getAllReferidosPaginated({page:this.paginator.pageIndex,size:this.paginator.pageSize,sortBy:this.sort.active,sortDir:this.sort.direction,searchQuery:this.query,grupoID:this.filterGrupoID,empresaID:this.filterEmpresID,statusEnum:this.filterEstatusEnum,usuarioID:this.filterUsuario}).pipe((0,G.W)(()=>(0,P.of)(null)))),(0,B.T)(t=>null===t?[]:(this.total=t.data.total,t.data.items))).subscribe(t=>{this.dataSourceTable=new u.I6(t)})}loadtableByEmpresa(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,I.h)(this.sort.sortChange,this.paginator.page).pipe((0,$.Z)({}),(0,y.n)(()=>this.referidoService.getReferidosByEmpresaPaginated({id:this.empresaID,page:this.paginator.pageIndex,size:this.paginator.pageSize,sortBy:this.sort.active,sortDir:this.sort.direction,searchQuery:this.query,statusEnum:this.filterEstatusEnum,usuarioID:this.filterUsuario}).pipe((0,G.W)(()=>(0,P.of)(null)))),(0,B.T)(t=>null===t?[]:(this.total=t.data.total,t.data.items))).subscribe(t=>{this.dataSourceTable=new u.I6(t)})}seguimientoModal(t){var o=this;return(0,C.A)(function*(){const a=yield o.modalCtrl.create({component:ee,cssClass:"modal-empresa",componentProps:{id:t}});yield a.present(),yield a.onDidDismiss(),o.loadtable()})()}formatFecha(t){if(null==t)return"No aplica";const o=new Date(t),a=o.getDate().toString().padStart(2,"0");let l=o.toLocaleString("es-MX",{month:"long"});return l=l.charAt(0).toUpperCase()+l.slice(1),`${a} ${l} ${o.getFullYear()}`}onGrupoSelect(t){null!=t.value&&null!=t.value&&(this.filterGrupoID=t.value.id,this.loadtable())}onGrupoClear(t){this.filterGrupoID=0,this.loadtable()}onEmpresaSelect(t){null!=t.value&&null!=t.value&&(this.filterEmpresID=t.value.id,this.loadtable())}onEmpresaClear(t){this.filterEmpresID=0,this.loadtable()}onEstatusSelect(t){null!=t.value&&null!=t.value&&(this.filterEstatusEnum=t.value.valor,this.loadtable())}onEstatusClear(t){this.filterEstatusEnum=void 0,this.loadtable()}onSearchChange(t){t.component.startSearch(),this.searchSubject.next(t)}setupSearch(){this.searchSubject.pipe((0,T.B)(300)).subscribe(t=>{const o=t.text.trim();if(o.length<2&&""!=o)return t.component.items=this.usuarios,void t.component.endSearch();this.usuarioService.busquedaUsuario(o.toLowerCase()).subscribe(a=>{this.usuarios=a.data,t.component.items=this.usuarios,t.component.endSearch()},a=>{t.component.items=[],t.component.endSearch()})})}onOpen(t){this.selectableComponent&&(this.selectableComponent._onSearchbarClear=function(){this._searchText="",this._filterItems()})}onUsuarioSelect(t){null!=t.value&&null!=t.value&&(this.filterUsuario=t.value.id,this.loadtable())}onUsuarioClear(t){this.filterUsuario=0,this.loadtable()}viewQR(t){var o=this;return(0,C.A)(function*(){var a=yield(0,_._)(o.referidoService.getQR(t));const l=yield o.modalCtrl.create({component:z,cssClass:"modal-empresa",componentProps:{imagenBase64:a.data}});yield l.present(),yield l.onDidDismiss()})()}}return(i=r).\u0275fac=function(t){return new(t||i)(e.rXU(s.Xi),e.rXU(te.z),e.rXU(ie.b),e.rXU(s.W3),e.rXU(oe.nX),e.rXU(ne.o),e.rXU(U))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-referencias"]],viewQuery:function(t,o){if(1&t&&(e.GBs(b.iy,5),e.GBs(S.B4,5),e.GBs(re,5)),2&t){let a;e.mGM(a=e.lsd())&&(o.paginator=a.first),e.mGM(a=e.lsd())&&(o.sort=a.first),e.mGM(a=e.lsd())&&(o.selectableComponent=a.first)}},standalone:!1,decls:65,vars:15,consts:[["selectableComponent",""],[1,"pagesHeader"],["slot","start"],["name","star","color","white"],[1,"pagesContent"],[1,"ion-align-items-center"],["size","12","size-md","9",1,"ion-text-center"],["autocomplete","off",1,"inputBusqueda",3,"ionInput","placeholder"],["slot","end","name","search","aria-hidden","true"],["size","12","size-md","3","class","ion-text-center",4,"ngIf"],["size","12","size-md","3",1,"ion-text-center"],[1,"inputBusqueda"],["position","floating"],["item-content","","itemValueField","valor","closeButtonSlot","end","itemTextField","nombre","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],[1,"referidosHeader"],[1,"title"],[2,"overflow-x","auto"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","Nombre"],["mat-header-cell","","style","padding-left: 1rem;","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","style","padding-left: 1rem;",4,"matCellDef"],["matColumnDef","Email"],["matColumnDef","Celular"],["matColumnDef","Producto"],["matColumnDef","Embajador"],["matColumnDef","Empresa"],["matColumnDef","Grupo"],["mat-cell","",4,"matCellDef"],["matColumnDef","EstatusReferencia"],["matColumnDef","QR"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","Visualizar"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","mydivoutermulti elemento-renglon",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"length","pageSizeOptions","pageSize"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","nombre","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","nombreCompleto","closeButtonText","Cancelar","searchPlaceholder","Buscar usuario...","clearButtonText","Limpiar",3,"onSearch","onOpen","onChange","onClear","items","searchFailText","canSearch","canClear"],["ionicSelectableMessageTemplate",""],["text-wrap",""],[2,"color","grey","font-size","small"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","razonSocial","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],["mat-header-cell","","mat-sort-header","",2,"padding-left","1rem"],["mat-cell","",2,"padding-left","1rem"],[4,"ngIf"],[3,"ngClass"],["mat-cell",""],[4,"ngFor","ngForOf"],["mat-header-cell",""],["fill","clear"],["fill","clear",3,"click"],["slot","icon-only","name","qr-code"],["slot","icon-only","name","eye"],["mat-header-row",""],["mat-row","",1,"mydivoutermulti","elemento-renglon"],[1,"mat-row"],[2,"text-align","center","padding","1rem"]],template:function(t,o){1&t&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title")(5,"h1"),e.nrm(6,"ion-icon",3),e.EFF(7," Referidos"),e.k0s()()()(),e.j41(8,"ion-content",4)(9,"div")(10,"ion-grid")(11,"ion-row",5)(12,"ion-col",6)(13,"ion-input",7),e.bIt("ionInput",function(l){return o.inputBuscar.next(l.detail.value||"")}),e.nrm(14,"ion-icon",8),e.k0s()()(),e.j41(15,"ion-row",5),e.DNE(16,se,5,3,"ion-col",9)(17,ce,7,4,"ion-col",9)(18,ue,5,3,"ion-col",9),e.j41(19,"ion-col",10)(20,"ion-item",11)(21,"ion-label",12),e.EFF(22,"Filtro por estatus"),e.k0s(),e.j41(23,"ionic-selectable",13),e.bIt("onChange",function(l){return o.onEstatusSelect(l)})("onClear",function(l){return o.onEstatusClear(l)}),e.k0s()()()()()(),e.j41(24,"ion-card")(25,"ion-card-header",14)(26,"ion-card-title",15),e.EFF(27,"Productos"),e.k0s()(),e.j41(28,"ion-card-content")(29,"div",16)(30,"table",17),e.qex(31,18),e.DNE(32,me,2,0,"th",19)(33,de,2,1,"td",20),e.bVm(),e.qex(34,21),e.DNE(35,fe,2,0,"th",19)(36,pe,2,1,"td",20),e.bVm(),e.qex(37,22),e.DNE(38,ge,2,0,"th",19)(39,he,2,1,"td",20),e.bVm(),e.qex(40,23),e.DNE(41,_e,2,0,"th",19)(42,Ce,3,2,"td",20),e.bVm(),e.qex(43,24),e.DNE(44,Se,2,0,"th",19)(45,Ee,2,1,"td",20),e.bVm(),e.qex(46,25),e.DNE(47,be,2,0,"th",19)(48,ve,2,1,"td",20),e.bVm(),e.qex(49,26),e.DNE(50,Fe,2,0,"th",19)(51,Te,2,1,"td",27),e.bVm(),e.qex(52,28),e.DNE(53,Ie,2,0,"th",19)(54,$e,2,1,"td",20),e.bVm(),e.qex(55,29),e.DNE(56,ye,2,0,"th",30)(57,Pe,2,1,"td",27),e.bVm(),e.qex(58,31),e.DNE(59,Be,2,0,"th",30)(60,xe,5,0,"td",27),e.bVm(),e.DNE(61,ke,1,0,"tr",32)(62,Ne,1,0,"tr",33)(63,Ue,3,1,"tr",34),e.k0s()(),e.nrm(64,"mat-paginator",35),e.k0s()()()),2&t&&(e.R7$(13),e.Y8G("placeholder",o.inputBusquedaText),e.R7$(3),e.Y8G("ngIf",o.rolUsuario===o.RolesEnum.Admin),e.R7$(),e.Y8G("ngIf",o.rolUsuario===o.RolesEnum.Admin),e.R7$(),e.Y8G("ngIf",o.rolUsuario===o.RolesEnum.Admin),e.R7$(5),e.Y8G("items",o.estatus)("canSearch",!0)("canClear",!0),e.R7$(7),e.Y8G("dataSource",o.dataSourceTable),e.R7$(31),e.Y8G("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),e.R7$(),e.Y8G("matRowDefColumns",o.displayedColumns),e.R7$(2),e.Y8G("length",o.total)("pageSizeOptions",e.lJ4(14,ae))("pageSize",50))},dependencies:[p.YU,p.Sq,p.bT,s.Jm,s.QW,s.b_,s.I9,s.ME,s.tN,s.hU,s.W9,s.lO,s.eU,s.iq,s.$w,s.uz,s.he,s.MC,s.ln,s.BC,s.ai,s.Gw,u.Zl,u.tL,u.ji,u.cC,u.YV,u.iL,u.KS,u.$R,u.YZ,u.NB,u.ky,b.iy,S.B4,S.aE,F.ec,F.pF],styles:[".text-success[_ngcontent-%COMP%]{color:green}.text-danger[_ngcontent-%COMP%]{color:red}"]}),r})()}];let Me=(()=>{var i;class r{}return(i=r).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[D.iI.forChild(Ve),D.iI]}),r})(),Xe=(()=>{var i;class r{}return(i=r).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[p.MD,d.YN,s.bv,Me,u.tP,b.Ou,S.NQ,F.ec]}),r})()}}]);