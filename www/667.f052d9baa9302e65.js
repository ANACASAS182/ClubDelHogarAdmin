"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[667],{667:(we,j,c)=>{c.r(j),c.d(j,{ReferenciasPageModule:()=>ke});var p=c(2881),f=c(9417),s=c(3092),y=c(9870),S=c(467),E=c(7550),_=c(2042),m=c(3662),F=c(1413),b=c(4843),I=c(152),V=c(3294),U=c(6977),P=c(7786),D=c(9172),T=c(5558),M=c(9437),k=c(7673),B=c(6354),h=function(i){return i[i.Creado=1]="Creado",i[i.Seguimiento=2]="Seguimiento",i[i.Cerrado=3]="Cerrado",i}(h||{});const X={Creado:"Creado",Seguimiento:"Seguimiento",Cerrado:"Cerrado"};function $(){return Object.keys(h).filter(i=>isNaN(Number(i))).map(i=>({nombre:X[i],valor:h[i]}))}var C=c(6231),e=c(1360);const Y=["class","qr view"];function A(i,a){if(1&i&&e.nrm(0,"img",8),2&i){const o=e.XpG();e.Y8G("src",o.imagenBase64,e.B4B)}}let z=(()=>{var i;class a{constructor(t){this.modalCtrl=t,this.imagenBase64=""}ngOnInit(){}close(){this.modalCtrl.dismiss()}}return(i=a).\u0275fac=function(t){return new(t||i)(e.rXU(s.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-modal",8,"qr","view"]],inputs:{imagenBase64:"imagenBase64"},attrs:Y,decls:10,vars:2,consts:[[1,"modalHeader"],["slot","end"],[3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[1,"modalform-title","ion-text-center"],[1,"upload-card"],[3,"src",4,"ngIf"],[3,"src"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",0)(1,"ion-buttons",1)(2,"ion-button",2),e.bIt("click",function(){return n.close()}),e.nrm(3,"ion-icon",3),e.k0s()()(),e.j41(4,"ion-content",4)(5,"h2",5),e.EFF(6," QR"),e.k0s(),e.j41(7,"ion-item")(8,"ion-card",6),e.DNE(9,A,1,1,"img",7),e.k0s()()()),2&t&&(e.R7$(4),e.Y8G("fullscreen",!1),e.R7$(5),e.Y8G("ngIf",n.imagenBase64))},dependencies:[s.bv,s.Jm,s.QW,s.b_,s.W9,s.eU,s.iq,s.uz,f.X1,p.MD,p.bT],encapsulation:2}),a})();var w=c(980),Q=c(5460),H=c(6152),v=c(7643),G=c(5312);let N=(()=>{var i;class a{constructor(t){this.http=t,this.apiUrl=G.c.apiUrl+"api/Referido"}getAllReferidosPaginated(t){let n=(new v.Nl).set("page",t.page.toString()).set("size",t.size.toString()).set("sortBy",t.sortBy).set("sortDir",t.sortDir).set("searchQuery",t.searchQuery||"").set("empresaID",t.empresaID.toString()).set("grupoID",t.grupoID.toString()).set("usuarioID",t.usuarioID.toString());return null!=t.statusEnum&&(n=n.set("estatus",t.statusEnum.toString())),this.http.get(`${this.apiUrl}/GetAllReferidosPaginated`,{params:n})}getReferidosByEmpresaPaginated(t){let n=(new v.Nl).set("empresaID",t.id.toString()).set("page",t.page.toString()).set("size",t.size.toString()).set("sortBy",t.sortBy).set("sortDir",t.sortDir).set("usuarioID",t.usuarioID.toString()).set("searchQuery",t.searchQuery||"");return null!=t.statusEnum&&(n=n.set("estatus",t.statusEnum.toString())),this.http.get(`${this.apiUrl}/GetReferidosByEmpresaPaginated`,{params:n})}getByID(t){let n=(new v.Nl).set("id",t);return this.http.get(`${this.apiUrl}/GetReferidoByID`,{params:n})}updateEstatus(t){return this.http.post(`${this.apiUrl}/UpdateStatus`,t)}getQR(t){let n=(new v.Nl).set("codigo",t);return this.http.get(`${this.apiUrl}/GetQR`,{params:n})}}return(i=a).\u0275fac=function(t){return new(t||i)(e.KVO(v.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),a})(),W=(()=>{var i;class a{constructor(t){this.http=t,this.apiUrl=G.c.apiUrl+"api/SeguimientoReferido"}getSeguimientosReferido(t){let n=(new v.Nl).set("referidoID",t);return this.http.get(`${this.apiUrl}/GetSeguimientoReferido`,{params:n})}save(t){return this.http.post(`${this.apiUrl}/Save`,t)}}return(i=a).\u0275fac=function(t){return new(t||i)(e.KVO(v.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),a})();const J=["class","seguimiento referencia"];function L(i,a){if(1&i&&(e.j41(0,"ion-chip",15),e.nrm(1,"ion-icon",26),e.j41(2,"ion-label"),e.EFF(3),e.k0s()()),2&i){const o=e.XpG();e.R7$(3),e.JRh(null==o.referido?null:o.referido.email)}}function Z(i,a){1&i&&(e.j41(0,"span",27),e.EFF(1,"Sin correo"),e.k0s())}function K(i,a){if(1&i&&(e.j41(0,"ion-select-option",28),e.EFF(1),e.k0s()),2&i){const o=a.$implicit,t=e.XpG();e.Y8G("value",o.valor+"")("disabled",t.isCreadoDisabled(o.valor)),e.R7$(),e.SpI(" ",o.nombre," ")}}function q(i,a){1&i&&(e.j41(0,"ion-text",33),e.EFF(1," Campo requerido "),e.k0s())}function ee(i,a){if(1&i){const o=e.RV6();e.j41(0,"ion-card",8)(1,"ion-card-header")(2,"ion-card-title",9),e.EFF(3,"Agregar seguimiento"),e.k0s()(),e.j41(4,"ion-card-content")(5,"div",29),e.nrm(6,"ion-textarea",30),e.DNE(7,q,2,0,"ion-text",31),e.j41(8,"div",20)(9,"ion-button",32),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.enviarFormulario())}),e.EFF(10," Enviar seguimiento "),e.k0s()()()()()}if(2&i){const o=e.XpG();e.R7$(5),e.Y8G("formGroup",o.formulario),e.R7$(),e.AVh("invalid",o.comentarioCtrl.invalid&&o.comentarioCtrl.touched),e.R7$(),e.Y8G("ngIf",o.comentarioCtrl.invalid&&o.comentarioCtrl.touched),e.R7$(2),e.Y8G("disabled",o.formEnviado||o.formulario.invalid)}}function te(i,a){if(1&i&&(e.j41(0,"div",36),e.nrm(1,"div",37),e.j41(2,"div",38)(3,"div",39),e.nrm(4,"ion-icon",40),e.j41(5,"span",41),e.EFF(6),e.k0s()(),e.j41(7,"div",42),e.EFF(8),e.k0s()()()),2&i){const o=a.$implicit,t=e.XpG(2);e.R7$(6),e.JRh(t.formatFecha(o.fechaSeguimiento)),e.R7$(2),e.JRh(o.comentario)}}function ie(i,a){if(1&i&&(e.j41(0,"div",34),e.DNE(1,te,9,2,"div",35),e.nI1(2,"slice"),e.k0s()),2&i){const o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.mostrarTodos?o.seguimientos:e.brH(2,2,o.seguimientos,0,5))("ngForTrackBy",o.trackByIndex)}}function ne(i,a){1&i&&(e.j41(0,"span",27),e.EFF(1,"A\xfan no hay seguimientos"),e.k0s())}function oe(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",20)(1,"ion-button",43),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.mostrarTodos=!n.mostrarTodos)}),e.EFF(2),e.k0s()()}if(2&i){const o=e.XpG();e.R7$(2),e.SpI(" ",o.mostrarTodos?"Ver menos":"Ver todos"," ")}}let re=(()=>{var i;class a{constructor(t,n,r,l,u,d,g){this.fb=t,this.modalCtrl=n,this.toastController=r,this.loadingCtrl=l,this.referidoService=u,this.seguimientoReferidoService=d,this.cdr=g,this.formulario=this.fb.group({comentario:["",[f.k0.required,(0,Q.a)()]]}),this.formStatus=this.fb.group({status:[null,f.k0.required]}),this.formEnviado=!1,this.numSeguimientos=0,this.seguimientos=[],this.estatus=$(),this.estatusReferenciaEnum=h,this.showSegForm=!1,this.mostrarTodos=!1}get statusCtrl(){return this.formStatus.get("status")}get comentarioCtrl(){return this.formulario.get("comentario")}getControl(t){return this.formulario.get(t)}toNumOrNull(t){const n=Number(t);return Number.isFinite(n)?n:null}ngOnInit(){var t=this;return(0,S.A)(function*(){const n=yield t.loadingCtrl.create({message:"Cargando datos..."});yield n.present();try{var r,l,u,d;const g=yield(0,b._)(t.referidoService.getByID(t.id));t.referido=g.data;const R=null!==(r=t.referido)&&void 0!==r?r:{},O=null!==(l=null!==(u=null!==(d=t.toNumOrNull(R.estatusReferenciaID))&&void 0!==d?d:t.toNumOrNull(R.EstatusReferenciaID))&&void 0!==u?u:t.toNumOrNull(R.estatusReferenciaEnum))&&void 0!==l?l:t.toNumOrNull(R.EstatusReferenciaEnum),Be=null!=O?String(O):null;t.formStatus.patchValue({status:Be},{emitEvent:!1}),t.statusCtrl.updateValueAndValidity({emitEvent:!1}),t.showSegForm=String(t.statusCtrl.value)===String(h.Seguimiento),t.cdr.detectChanges(),t.statusCtrl.valueChanges.subscribe($e=>{t.showSegForm=String($e)===String(h.Seguimiento)}),t.getSeguimientos()}catch(g){console.error("Error al cargar datos",g)}finally{n.dismiss()}})()}getSeguimientos(){this.seguimientoReferidoService.getSeguimientosReferido(this.id).subscribe({next:t=>{this.seguimientos=t.data||[],this.numSeguimientos=this.seguimientos.length}})}isCreadoDisabled(t){return String(t)===String(h.Creado)&&this.statusCtrl.value!==String(h.Creado)}enviarFormularioStatus(){if(this.formEnviado)return;if(this.formEnviado=!0,this.formStatus.invalid)return this.formStatus.markAllAsTouched(),void(this.formEnviado=!1);const t=Number(this.statusCtrl.value);this.referidoService.updateEstatus({id:this.id,estatusReferenciaEnum:t}).pipe((0,w.j)(()=>this.formEnviado=!1)).subscribe({next:r=>{null!=r&&r.data&&(this.referido&&(this.referido.estatusReferenciaEnum=t,this.referido.EstatusReferenciaID=t),this.showSegForm=String(t)===String(h.Seguimiento),this.toastController.create({message:"Estatus actualizado.",duration:2200,color:"success",position:"top"}).then(l=>l.present()),this.getSeguimientos())}})}enviarFormulario(){if(this.formEnviado)return;if(this.formEnviado=!0,this.formulario.invalid)return this.formulario.markAllAsTouched(),void(this.formEnviado=!1);const t={comentario:(0,H.H)(this.comentarioCtrl.value),referidoID:this.id};this.seguimientoReferidoService.save(t).pipe((0,w.j)(()=>this.formEnviado=!1)).subscribe({next:n=>{null!=n&&n.data&&(this.toastController.create({message:"Seguimiento guardado.",duration:2200,color:"success",position:"top"}).then(r=>r.present()),this.getSeguimientos(),this.formulario.reset())}})}close(){this.modalCtrl.dismiss()}formatFecha(t){const n=new Date(t),r=n.getDate().toString().padStart(2,"0");let l=n.toLocaleString("es-MX",{month:"long"});return l=l.charAt(0).toUpperCase()+l.slice(1),`${r}-${l}-${n.getFullYear()}`}trackByIndex(t){return t}}return(i=a).\u0275fac=function(t){return new(t||i)(e.rXU(f.ok),e.rXU(s.W3),e.rXU(s.K_),e.rXU(s.Xi),e.rXU(N),e.rXU(W),e.rXU(e.gRc))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-modal",8,"seguimiento","referencia"]],inputs:{id:"id"},attrs:J,decls:67,vars:15,consts:[["sinCorreo",""],["sinSeg",""],[1,"modalHeader"],["slot","end"],["aria-label","Cerrar",1,"btn-close",3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[1,"modalform-title","ion-text-center"],[1,"section-card"],[1,"section-title"],[1,"detail-grid"],[1,"detail-row"],[1,"detail-label"],[1,"detail-value"],["outline","true","color","medium","class","chip",4,"ngIf","ngIfElse"],["outline","true","color","medium",1,"chip"],["name","call-outline"],[1,"status-form",3,"ngSubmit","formGroup"],["okText","Ok","cancelText","Cancelar","label-placement","floating","label","Estatus seguimiento","formControlName","status",1,"inputForm",3,"ionBlur"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"actions-row"],["type","submit",3,"disabled"],["class","section-card",4,"ngIf"],[1,"count"],["class","timeline",4,"ngIf","ngIfElse"],["class","actions-row",4,"ngIf"],["name","mail-outline"],[1,"muted"],[3,"value","disabled"],[3,"formGroup"],["formControlName","comentario","label-placement","floating","label","Seguimiento","autoGrow","true","rows","4","maxlength","500","placeholder","Escribe tu seguimiento",1,"inputForm"],["color","danger",4,"ngIf"],[3,"click","disabled"],["color","danger"],[1,"timeline"],["class","tl-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tl-item"],[1,"tl-dot"],[1,"tl-card"],[1,"tl-row"],["name","time-outline"],[1,"tl-date"],[1,"tl-text"],["size","small","fill","clear",3,"click"]],template:function(t,n){if(1&t){const r=e.RV6();e.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-buttons",3)(3,"ion-button",4),e.bIt("click",function(){return e.eBV(r),e.Njj(n.close())}),e.nrm(4,"ion-icon",5),e.k0s()()()(),e.j41(5,"ion-content",6)(6,"h2",7),e.EFF(7,"Seguimiento de referido"),e.k0s(),e.j41(8,"ion-card",8)(9,"ion-card-header")(10,"ion-card-title",9),e.EFF(11,"Referido"),e.k0s()(),e.j41(12,"ion-card-content")(13,"div",10)(14,"div",11)(15,"div",12),e.EFF(16,"Nombre"),e.k0s(),e.j41(17,"div",13),e.EFF(18),e.k0s()(),e.j41(19,"div",11)(20,"div",12),e.EFF(21,"Email"),e.k0s(),e.j41(22,"div",13),e.DNE(23,L,4,1,"ion-chip",14)(24,Z,2,0,"ng-template",null,0,e.C5r),e.k0s()(),e.j41(26,"div",11)(27,"div",12),e.EFF(28,"Celular"),e.k0s(),e.j41(29,"div",13)(30,"ion-chip",15),e.nrm(31,"ion-icon",16),e.j41(32,"ion-label"),e.EFF(33),e.k0s()()()(),e.j41(34,"div",11)(35,"div",12),e.EFF(36,"Producto"),e.k0s(),e.j41(37,"div",13),e.EFF(38),e.k0s()(),e.j41(39,"div",11)(40,"div",12),e.EFF(41,"Embajador"),e.k0s(),e.j41(42,"div",13),e.EFF(43),e.k0s()()()()(),e.j41(44,"ion-card",8)(45,"ion-card-header")(46,"ion-card-title",9),e.EFF(47,"Estatus"),e.k0s()(),e.j41(48,"ion-card-content")(49,"form",17),e.bIt("ngSubmit",function(){return e.eBV(r),e.Njj(n.enviarFormularioStatus())}),e.j41(50,"ion-select",18),e.bIt("ionBlur",function(){return e.eBV(r),e.Njj(n.statusCtrl.markAsTouched())}),e.DNE(51,K,2,3,"ion-select-option",19),e.k0s(),e.j41(52,"div",20)(53,"ion-button",21),e.EFF(54," Actualizar estatus "),e.k0s()()()()(),e.DNE(55,ee,11,5,"ion-card",22),e.j41(56,"ion-card",8)(57,"ion-card-header")(58,"ion-card-title",9),e.EFF(59," Seguimientos "),e.j41(60,"span",23),e.EFF(61),e.k0s()()(),e.j41(62,"ion-card-content"),e.DNE(63,ie,3,6,"div",24)(64,ne,2,0,"ng-template",null,1,e.C5r)(66,oe,3,1,"div",25),e.k0s()()()}if(2&t){let r,l;const u=e.sdS(25),d=e.sdS(65);e.R7$(5),e.Y8G("fullscreen",!1),e.R7$(13),e.JRh(null==n.referido?null:n.referido.nombreCompleto),e.R7$(5),e.Y8G("ngIf",null==n.referido?null:n.referido.email)("ngIfElse",u),e.R7$(10),e.JRh((null==n.referido?null:n.referido.celular)||"No proporcionado"),e.R7$(5),e.JRh(null==n.referido?null:n.referido.productoNombre),e.R7$(5),e.JRh(null==n.referido?null:n.referido.usuarioNombreCompleto),e.R7$(6),e.Y8G("formGroup",n.formStatus),e.R7$(2),e.Y8G("ngForOf",n.estatus),e.R7$(2),e.Y8G("disabled",n.formEnviado||n.formStatus.invalid),e.R7$(2),e.Y8G("ngIf",n.showSegForm),e.R7$(6),e.SpI("(",n.numSeguimientos,")"),e.R7$(2),e.Y8G("ngIf",(null!==(r=null==n.seguimientos?null:n.seguimientos.length)&&void 0!==r?r:0)>0)("ngIfElse",d),e.R7$(3),e.Y8G("ngIf",(null!==(l=null==n.seguimientos?null:n.seguimientos.length)&&void 0!==l?l:0)>5)}},dependencies:[s.bv,s.Jm,s.QW,s.b_,s.I9,s.ME,s.tN,s.ZB,s.W9,s.eU,s.iq,s.he,s.Nm,s.Ip,s.IO,s.nc,s.ai,s.Je,s.Gw,f.X1,f.qT,f.BC,f.cb,f.tU,f.j4,f.JD,p.MD,p.Sq,p.bT,p.P9],styles:['@charset "UTF-8";.modalform-title[_ngcontent-%COMP%]{margin:4px 0 12px;letter-spacing:.2px}.section-card[_ngcontent-%COMP%]{border-radius:16px;box-shadow:0 8px 18px #0000000f;margin-bottom:14px}.section-title[_ngcontent-%COMP%]{font-size:16px;font-weight:700}.count[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-medium)}.detail-grid[_ngcontent-%COMP%]{--label-w: 120px}.detail-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:var(--label-w) 1fr;column-gap:12px;row-gap:8px;padding:6px 0;border-bottom:1px solid rgba(0,0,0,.05)}.detail-row[_ngcontent-%COMP%]:last-child{border-bottom:0}.detail-label[_ngcontent-%COMP%]{font-weight:600;color:var(--ion-color-medium);text-align:right;white-space:nowrap}.detail-value[_ngcontent-%COMP%]{line-height:1.25;word-break:break-word}.chip[_ngcontent-%COMP%]{height:28px;--background: #fff;--color: var(--ion-color-dark);--padding-start: 6px;--padding-end: 8px}.actions-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:8px}.timeline[_ngcontent-%COMP%]{position:relative;margin-top:6px;padding-left:16px}.timeline[_ngcontent-%COMP%]:before{content:"";position:absolute;left:7px;top:0;bottom:0;width:2px;background:#00000014}.tl-item[_ngcontent-%COMP%]{position:relative;margin:8px 0 12px}.tl-dot[_ngcontent-%COMP%]{position:absolute;left:-1px;top:6px;width:12px;height:12px;border-radius:50%;background:var(--ion-color-primary);box-shadow:0 0 0 3px rgba(var(--ion-color-primary-rgb, 56, 128, 255),.15)}.tl-card[_ngcontent-%COMP%]{background:var(--ion-background-color, #fff);border:1px solid rgba(0,0,0,.06);border-radius:12px;padding:8px 12px;box-shadow:0 2px 6px #0000000a}.tl-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;margin-bottom:4px;color:var(--ion-color-medium);font-size:12px}.tl-text[_ngcontent-%COMP%]{white-space:pre-wrap;line-height:1.25}.muted[_ngcontent-%COMP%]{color:var(--ion-color-medium)}@media (max-width: 420px){.detail-grid[_ngcontent-%COMP%]{--label-w: 100px}.detail-label[_ngcontent-%COMP%]{text-align:left}.detail-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.modalHeader[_ngcontent-%COMP%]{box-shadow:none}.modalHeader[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--padding-end: calc(env(safe-area-inset-right) + 20px) ;--padding-start: calc(env(safe-area-inset-left) + 12px) ;--min-height: 44px;--border-width: 0;--border-color: transparent;background:transparent;box-shadow:none}.btn-close[_ngcontent-%COMP%]{width:36px;height:36px;--border-radius: 9999px;--background: rgba(0,0,0,.06);--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0;box-shadow:none}.btn-close[_ngcontent-%COMP%]:hover{--background: rgba(0,0,0,.1)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: #fff !important}']}),a})();var ae=c(8311),se=c(6897),le=c(1628),ce=c(7248),x=c(2490);const ue=["selectableComponent"],de=()=>[20,50,100];function me(i,a){if(1&i){const o=e.RV6();e.j41(0,"ion-col",10)(1,"ion-item",11)(2,"ion-label",12),e.EFF(3,"Filtro por empresa"),e.k0s(),e.j41(4,"ionic-selectable",30),e.bIt("onChange",function(n){e.eBV(o);const r=e.XpG();return e.Njj(r.onEmpresaSelect(n))})("onClear",function(n){e.eBV(o);const r=e.XpG();return e.Njj(r.onEmpresaClear(n))}),e.k0s()()()}if(2&i){const o=e.XpG();e.R7$(4),e.Y8G("items",o.empresas)("canSearch",!0)("canClear",!0)}}function ge(i,a){1&i&&(e.j41(0,"ion-item",33)(1,"p",34),e.EFF(2," Solo se muestran los primeros 30 usuarios encontrados. Si no encuentra el deseado, utilice el buscador para obtener un resultado m\xe1s preciso. "),e.k0s()())}function fe(i,a){if(1&i){const o=e.RV6();e.j41(0,"ion-col",10)(1,"ion-item",11)(2,"ion-label",12),e.EFF(3,"Filtro por embajador"),e.k0s(),e.j41(4,"ionic-selectable",31,0),e.bIt("onSearch",function(n){e.eBV(o);const r=e.XpG();return e.Njj(r.onSearchChange(n))})("onOpen",function(n){e.eBV(o);const r=e.XpG();return e.Njj(r.onOpen(n))})("onChange",function(n){e.eBV(o);const r=e.XpG();return e.Njj(r.onUsuarioSelect(n))})("onClear",function(n){e.eBV(o);const r=e.XpG();return e.Njj(r.onUsuarioClear(n))}),e.DNE(6,ge,3,0,"ng-template",32),e.k0s()()()}if(2&i){const o=e.XpG();e.R7$(4),e.Y8G("items",o.usuarios)("searchFailText","No se encontraron usuarios.")("canSearch",!0)("canClear",!0)}}function pe(i,a){1&i&&(e.j41(0,"th",35),e.EFF(1," Nombre "),e.k0s())}function he(i,a){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=a.$implicit;e.R7$(),e.SpI(" ",o.nombre," ")}}function ve(i,a){1&i&&(e.j41(0,"th",35),e.EFF(1," Contacto "),e.k0s())}function be(i,a){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=a.$implicit;e.R7$(),e.Lme(" ",o.email," ",o.celular," ")}}function Ce(i,a){1&i&&(e.j41(0,"th",35),e.EFF(1," Producto "),e.k0s())}function Se(i,a){if(1&i&&(e.qex(0),e.j41(1,"span",39),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.bVm()),2&i){const o=a.ngIf;e.R7$(2),e.SpI(" \u2022 hasta ",e.ii3(3,1,o,"dd MMMM y","","es-MX"),"")}}function _e(i,a){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.j41(2,"div")(3,"small")(4,"span",37),e.EFF(5),e.k0s(),e.DNE(6,Se,4,6,"ng-container",38),e.k0s()()()),2&i){const o=a.$implicit,t=e.XpG();e.R7$(),e.SpI(" ",o.producto," "),e.R7$(3),e.Y8G("ngClass",o.productoVigente?"vigencia-label":"text-danger"),e.R7$(),e.SpI(" ",o.productoVigente?"Vigente":"No vigente"," "),e.R7$(),e.Y8G("ngIf",t.getFechaVigencia(o))}}function Re(i,a){1&i&&(e.j41(0,"th",35),e.EFF(1," Embajador "),e.k0s())}function Ee(i,a){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=a.$implicit;e.R7$(),e.SpI(" ",o.embajador," ")}}function Fe(i,a){1&i&&(e.j41(0,"th",35),e.EFF(1," Empresa "),e.k0s())}function xe(i,a){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=a.$implicit;e.R7$(),e.SpI(" ",o.empresa," ")}}function je(i,a){1&i&&(e.j41(0,"th",35),e.EFF(1," Estatus Referencia "),e.k0s())}function ye(i,a){if(1&i&&(e.j41(0,"td",36),e.EFF(1),e.k0s()),2&i){const o=a.$implicit;e.R7$(),e.SpI(" ",o.estatusRerefencia," ")}}function Ie(i,a){1&i&&e.nrm(0,"tr",40)}function Pe(i,a){if(1&i){const o=e.RV6();e.j41(0,"tr",41),e.bIt("click",function(){const n=e.eBV(o).$implicit,r=e.XpG();return e.Njj(r.seguimientoModal(n.id))}),e.k0s()}}function De(i,a){if(1&i&&(e.j41(0,"tr",42)(1,"td",43),e.EFF(2," No se encontraron registros disponibles. "),e.k0s()()),2&i){const o=e.XpG();e.R7$(),e.BMQ("colspan",o.displayedColumns.length)}}const Te=[{path:"",component:(()=>{var i;class a{constructor(t,n,r,l,u,d,g){this.loadingCtrl=t,this.empresasService=n,this.grupoService=r,this.modalCtrl=l,this.route=u,this.usuarioService=d,this.referidoService=g,this.dataSourceTable=new m.I6,this.displayedColumns=[],this.allColumns=["Nombre","Email","Producto","Embajador","EstatusReferencia"],this.inputBuscar=new F.B,this.query="",this.empresaID=0,this.userid=0,this.inputBusquedaText="Buscar por nombre, email, celular o producto",this.RolesEnum=C.$u,this.grupos=[],this.empresas=[],this.estatus=[],this.filterEmpresID=0,this.filterGrupoID=0,this.filterEstatusEnum=void 0,this.filterUsuario=0,this.usuarios=[],this.searchSubject=new F.B,this.destroy$=new F.B,this.setupSearch()}ngAfterViewInit(){}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnInit(){var t=this;return(0,S.A)(function*(){var n;let l=t.route.snapshot.data.resolverData.usuario;if(t.rolUsuario=null===(n=l.roles)||void 0===n?void 0:n.enumValue,t.estatus=$(),t.userid=l.id,t.displayedColumns=[...t.allColumns],t.rolUsuario===C.$u.Admin){const g=t.displayedColumns.indexOf("Producto");-1!==g&&t.displayedColumns.splice(g+1,0,"Empresa"),t.inputBusquedaText="Buscar por nombre, email, celular, producto, empresa o grupo"}const u=yield t.loadingCtrl.create({message:"Cargando datos..."});yield u.present();try{if(t.rolUsuario==C.$u.Socio){const d=yield(0,b._)(t.usuarioService.getEmpresaByUsuario(t.userid));t.empresaID=d.data.id}else{const d=yield(0,b._)(t.empresasService.getAllEmpresas());t.empresas=(null==d?void 0:d.data)||[];const g=yield(0,b._)(t.grupoService.getAllGrupos());t.grupos=(null==g?void 0:g.data)||[]}t.dataSourceTable.paginator=t.paginator,t.loadtable()}catch(d){console.error("Error al cargar datos",d)}finally{u.dismiss()}t.inputBuscar.pipe((0,I.B)(1e3),(0,V.F)(),(0,U.Q)(t.destroy$)).subscribe(d=>{t.query=d.toString(),t.loadtable()})})()}loadtable(){switch(this.rolUsuario){case C.$u.Admin:this.loadtableAll();break;case C.$u.Socio:this.loadtableByEmpresa()}}loadtableAll(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,P.h)(this.sort.sortChange,this.paginator.page).pipe((0,D.Z)({}),(0,T.n)(()=>this.referidoService.getAllReferidosPaginated({page:this.paginator.pageIndex,size:this.paginator.pageSize,sortBy:this.sort.active,sortDir:this.sort.direction,searchQuery:this.query,grupoID:this.filterGrupoID,empresaID:this.filterEmpresID,statusEnum:this.filterEstatusEnum,usuarioID:this.filterUsuario}).pipe((0,M.W)(()=>(0,k.of)(null)))),(0,B.T)(t=>null===t?[]:(this.total=t.data.total,t.data.items))).subscribe(t=>{this.dataSourceTable=new m.I6(t)})}loadtableByEmpresa(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,P.h)(this.sort.sortChange,this.paginator.page).pipe((0,D.Z)({}),(0,T.n)(()=>this.referidoService.getReferidosByEmpresaPaginated({id:this.empresaID,page:this.paginator.pageIndex,size:this.paginator.pageSize,sortBy:this.sort.active,sortDir:this.sort.direction,searchQuery:this.query,statusEnum:this.filterEstatusEnum,usuarioID:this.filterUsuario}).pipe((0,M.W)(()=>(0,k.of)(null)))),(0,B.T)(t=>null===t?[]:(this.total=t.data.total,t.data.items))).subscribe(t=>{this.dataSourceTable=new m.I6(t)})}seguimientoModal(t){var n=this;return(0,S.A)(function*(){const r=yield n.modalCtrl.create({component:re,cssClass:"modal-empresa",componentProps:{id:t}});yield r.present(),yield r.onDidDismiss(),n.loadtable()})()}formatFecha(t){if(null==t)return"No aplica";const n=new Date(t),r=n.getDate().toString().padStart(2,"0");let l=n.toLocaleString("es-MX",{month:"long"});return l=l.charAt(0).toUpperCase()+l.slice(1),`${r} ${l} ${n.getFullYear()}`}onGrupoSelect(t){null!=t.value&&null!=t.value&&(this.filterGrupoID=t.value.id,this.loadtable())}onGrupoClear(t){this.filterGrupoID=0,this.loadtable()}onEmpresaSelect(t){null!=t.value&&null!=t.value&&(this.filterEmpresID=t.value.id,this.loadtable())}onEmpresaClear(t){this.filterEmpresID=0,this.loadtable()}onEstatusSelect(t){null!=t.value&&null!=t.value&&(this.filterEstatusEnum=t.value.valor,this.loadtable())}onEstatusClear(t){this.filterEstatusEnum=void 0,this.loadtable()}onSearchChange(t){t.component.startSearch(),this.searchSubject.next(t)}setupSearch(){this.searchSubject.pipe((0,I.B)(300)).subscribe(t=>{const n=t.text.trim();if(n.length<2&&""!=n)return t.component.items=this.usuarios,void t.component.endSearch();this.usuarioService.busquedaUsuario(n.toLowerCase()).subscribe(r=>{this.usuarios=r.data,t.component.items=this.usuarios,t.component.endSearch()},r=>{t.component.items=[],t.component.endSearch()})})}onOpen(t){this.selectableComponent&&(this.selectableComponent._onSearchbarClear=function(){this._searchText="",this._filterItems()})}onUsuarioSelect(t){null!=t.value&&null!=t.value&&(this.filterUsuario=t.value.id,this.loadtable())}onUsuarioClear(t){this.filterUsuario=0,this.loadtable()}viewQR(t){var n=this;return(0,S.A)(function*(){var r=yield(0,b._)(n.referidoService.getQR(t));const l=yield n.modalCtrl.create({component:z,cssClass:"modal-empresa",componentProps:{imagenBase64:r.data}});yield l.present(),yield l.onDidDismiss()})()}getFechaVigencia(t){if(!t||"object"!=typeof t)return null;const n=["vigencia","fechaVigencia","vigenteHasta","vigenciaHasta","fechaFinVigencia","fechaVencimiento","finVigencia"];for(const r of n){const l=t[r];if(null!=l){if(l instanceof Date)return l;if("string"==typeof l||"number"==typeof l){const u=new Date(l);if(!isNaN(u.getTime()))return u}}}if(t.vigente&&("string"==typeof t.vigente||"number"==typeof t.vigente)){const r=new Date(t.vigente);if(!isNaN(r.getTime()))return r}return null}}return(i=a).\u0275fac=function(t){return new(t||i)(e.rXU(s.Xi),e.rXU(ae.z),e.rXU(se.b),e.rXU(s.W3),e.rXU(le.nX),e.rXU(ce.o),e.rXU(N))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-referencias"]],viewQuery:function(t,n){if(1&t&&(e.GBs(E.iy,5),e.GBs(_.B4,5),e.GBs(ue,5)),2&t){let r;e.mGM(r=e.lsd())&&(n.paginator=r.first),e.mGM(r=e.lsd())&&(n.sort=r.first),e.mGM(r=e.lsd())&&(n.selectableComponent=r.first)}},standalone:!1,decls:52,vars:14,consts:[["selectableComponent",""],[1,"pagesHeader"],["slot","start"],["name","star","color","white"],[1,"pagesContent"],[1,"ion-align-items-center"],["size","12","size-md","9",1,"ion-text-center"],["autocomplete","off",1,"inputBusqueda",3,"ionInput","placeholder"],["slot","end","name","search","aria-hidden","true"],["size","12","size-md","3","class","ion-text-center",4,"ngIf"],["size","12","size-md","3",1,"ion-text-center"],[1,"inputBusqueda"],["position","floating"],["item-content","","itemValueField","valor","closeButtonSlot","end","itemTextField","nombre","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],[1,"referidosHeader"],[1,"title"],[2,"overflow-x","auto"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","Nombre"],["mat-header-cell","","style","padding-left: 1rem;","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","style","padding-left: 1rem;",4,"matCellDef"],["matColumnDef","Email"],["matColumnDef","Producto"],["matColumnDef","Embajador"],["matColumnDef","Empresa"],["matColumnDef","EstatusReferencia"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","mydivoutermulti elemento-renglon row_clickable",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"length","pageSizeOptions","pageSize"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","razonSocial","closeButtonText","Cancelar","clearButtonText","Limpiar",3,"onChange","onClear","items","canSearch","canClear"],["item-content","","itemValueField","id","closeButtonSlot","end","itemTextField","nombreCompleto","closeButtonText","Cancelar","searchPlaceholder","Buscar usuario...","clearButtonText","Limpiar",3,"onSearch","onOpen","onChange","onClear","items","searchFailText","canSearch","canClear"],["ionicSelectableMessageTemplate",""],["text-wrap",""],[2,"color","grey","font-size","small"],["mat-header-cell","","mat-sort-header","",2,"padding-left","1rem"],["mat-cell","",2,"padding-left","1rem"],[3,"ngClass"],[4,"ngIf"],[1,"vigencia-fecha"],["mat-header-row",""],["mat-row","",1,"mydivoutermulti","elemento-renglon","row_clickable",3,"click"],[1,"mat-row"],[2,"text-align","center","padding","1rem"]],template:function(t,n){1&t&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title")(5,"h1"),e.nrm(6,"ion-icon",3),e.EFF(7," Referencia"),e.k0s()()()(),e.j41(8,"ion-content",4)(9,"div")(10,"ion-grid")(11,"ion-row",5)(12,"ion-col",6)(13,"ion-input",7),e.bIt("ionInput",function(l){return n.inputBuscar.next(l.detail.value||"")}),e.nrm(14,"ion-icon",8),e.k0s()()(),e.j41(15,"ion-row",5),e.DNE(16,me,5,3,"ion-col",9)(17,fe,7,4,"ion-col",9),e.j41(18,"ion-col",10)(19,"ion-item",11)(20,"ion-label",12),e.EFF(21,"Filtro por estatus"),e.k0s(),e.j41(22,"ionic-selectable",13),e.bIt("onChange",function(l){return n.onEstatusSelect(l)})("onClear",function(l){return n.onEstatusClear(l)}),e.k0s()()()()()(),e.j41(23,"ion-card")(24,"ion-card-header",14)(25,"ion-card-title",15),e.EFF(26,"Referencias"),e.k0s()(),e.j41(27,"ion-card-content")(28,"div",16)(29,"table",17),e.qex(30,18),e.DNE(31,pe,2,0,"th",19)(32,he,2,1,"td",20),e.bVm(),e.qex(33,21),e.DNE(34,ve,2,0,"th",19)(35,be,2,2,"td",20),e.bVm(),e.qex(36,22),e.DNE(37,Ce,2,0,"th",19)(38,_e,7,4,"td",20),e.bVm(),e.qex(39,23),e.DNE(40,Re,2,0,"th",19)(41,Ee,2,1,"td",20),e.bVm(),e.qex(42,24),e.DNE(43,Fe,2,0,"th",19)(44,xe,2,1,"td",20),e.bVm(),e.qex(45,25),e.DNE(46,je,2,0,"th",19)(47,ye,2,1,"td",20),e.bVm(),e.DNE(48,Ie,1,0,"tr",26)(49,Pe,1,0,"tr",27)(50,De,3,1,"tr",28),e.k0s()(),e.nrm(51,"mat-paginator",29),e.k0s()()()),2&t&&(e.R7$(13),e.Y8G("placeholder",n.inputBusquedaText),e.R7$(3),e.Y8G("ngIf",n.rolUsuario===n.RolesEnum.Admin),e.R7$(),e.Y8G("ngIf",n.rolUsuario===n.RolesEnum.Admin),e.R7$(5),e.Y8G("items",n.estatus)("canSearch",!0)("canClear",!0),e.R7$(7),e.Y8G("dataSource",n.dataSourceTable),e.R7$(19),e.Y8G("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),e.R7$(),e.Y8G("matRowDefColumns",n.displayedColumns),e.R7$(2),e.Y8G("length",n.total)("pageSizeOptions",e.lJ4(13,de))("pageSize",50))},dependencies:[p.YU,p.bT,s.QW,s.b_,s.I9,s.ME,s.tN,s.hU,s.W9,s.lO,s.eU,s.iq,s.$w,s.uz,s.he,s.MC,s.ln,s.BC,s.ai,s.Gw,m.Zl,m.tL,m.ji,m.cC,m.YV,m.iL,m.KS,m.$R,m.YZ,m.NB,m.ky,E.iy,_.B4,_.aE,x.ec,x.pF,p.vh],styles:[".text-success[_ngcontent-%COMP%]{color:#22c55e;font-weight:600}.text-danger[_ngcontent-%COMP%]{color:#ef4444;font-weight:600}td[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{opacity:.9}.vigencia-label[_ngcontent-%COMP%]{font-weight:600;color:#16a34a}.vigencia-fecha[_ngcontent-%COMP%]{font-weight:600;color:#2563eb;margin-left:4px}"]}),a})()}];let Me=(()=>{var i;class a{}return(i=a).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[y.iI.forChild(Te),y.iI]}),a})(),ke=(()=>{var i;class a{}return(i=a).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[p.MD,f.YN,s.bv,Me,m.tP,E.Ou,_.NQ,x.ec]}),a})()}}]);