<div class="reset-wrapper">
  <div class="reset-card">
    <img src="/assets/logo_transparente.png" alt="Embassy" class="logo" />
    <h2 class="title">Restablecer contraseña</h2>
    <p class="subtitle">Crea una nueva contraseña para tu cuenta.</p>

    <div *ngIf="errorMsg" class="alert warn">{{ errorMsg }}</div>
    <div *ngIf="okMsg" class="alert ok">{{ okMsg }}</div>

    <!-- ✅ Formulario solo si token válido y aún no mostramos descargas -->
    <form *ngIf="validToken && !showDownload" [formGroup]="form" (ngSubmit)="submit()">
      <!-- Nueva contraseña -->
      <label class="label">Nueva contraseña</label>
      <div class="input-wrap">
        <input
          [type]="showPass ? 'text' : 'password'"
          formControlName="password"
          class="input"
          placeholder="••••••••"
          (input)="checkStrength()"
        />
        <button
          type="button"
          class="eye-btn"
          (click)="togglePass()"
          [attr.aria-label]="showPass ? 'Ocultar contraseña' : 'Mostrar contraseña'">
          <!-- ojo cerrado -->
          <svg *ngIf="!showPass" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5C5 5 2 12 2 12s3 7 10 7 10-7 10-7-3-7-10-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"/>
          </svg>
          <!-- ojo abierto (ocultar) -->
          <svg *ngIf="showPass" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3.3 2 2 3.3 5.2 6.6C3.1 8 2 10 2 12c0 0 3 7 10 7 2 0 3.8-.6 5.4-1.5l1.7 1.7 1.3-1.3L3.3 2Zm7.6 9.2a3.5 3.5 0 0 0 4 4l-4-4Zm1-5.2c7 0 10 7 10 7a14.6 14.6 0 0 1-4.3 5.1l-1.5-1.5A12.3 12.3 0 0 0 22 12s-3-7-10-7c-.8 0-1.6.1-2.3.3l1.2 1.2c.4 0 .7-.1 1.1-.1Z"/>
          </svg>
        </button>
      </div>
      <small class="hint error"
        *ngIf="form.controls.password.touched && form.controls.password.errors">
        La contraseña debe tener al menos 6 caracteres.
      </small>

      <!-- Confirmar -->
      <label class="label">Confirmar nueva contraseña</label>
      <div class="input-wrap">
        <input
          [type]="showConfirm ? 'text' : 'password'"
          formControlName="confirmPassword"
          class="input"
          placeholder="••••••••"
        />
        <button
          type="button"
          class="eye-btn"
          (click)="toggleConfirm()"
          [attr.aria-label]="showConfirm ? 'Ocultar contraseña' : 'Mostrar contraseña'">
          <svg *ngIf="!showConfirm" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 5C5 5 2 12 2 12s3 7 10 7 10-7 10-7-3-7-10-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"/>
          </svg>
          <svg *ngIf="showConfirm" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3.3 2 2 3.3 5.2 6.6C3.1 8 2 10 2 12c0 0 3 7 10 7 2 0 3.8-.6 5.4-1.5l1.7 1.7 1.3-1.3L3.3 2Zm7.6 9.2a3.5 3.5 0 0 0 4 4l-4-4Zm1-5.2c7 0 10 7 10 7a14.6 14.6 0 0 1-4.3 5.1l-1.5-1.5A12.3 12.3 0 0 0 22 12s-3-7-10-7c-.8 0-1.6.1-2.3.3l1.2 1.2c.4 0 .7-.1 1.1-.1Z"/>
          </svg>
        </button>
      </div>
      <small class="hint error"
        *ngIf="form.controls.confirmPassword.touched && form.controls.confirmPassword.errors">
        Campo requerido.
      </small>

      <button type="submit" class="btn" [disabled]="loading">Cambiar contraseña</button>
      <p class="footnote">El enlace expira tras unas horas por seguridad.</p>
    </form>

    <!-- ✅ Pantalla de descarga tras éxito -->
    <div *ngIf="showDownload" class="download-block">
      <h3 class="download-title">¡Contraseña actualizada!</h3>
      <p class="download-subtitle">
        Recuerda descargar nuestra app para aprovechar al máximo todas las funcionalidades.
      </p>

      <div class="app-links">
        <a href="https://play.google.com/store/apps/details?id=com.embassybusiness.app" target="_blank" rel="noopener">
          <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Google Play" />
        </a>
        <a href="https://apps.apple.com/mx/app/embassy/id6747898144" target="_blank" rel="noopener">
          <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg" alt="App Store" />
        </a>
      </div>

      <!-- <button class="btn secondary" (click)="goLogin()">Ir al inicio de sesión</button>  -->
    </div>

    <!-- Mensaje alterno si es inválido -->
    <div *ngIf="!validToken && !okMsg && errorMsg" class="info">
      Si necesitas otro enlace, solicita nuevamente el cambio de contraseña.
    </div>
  </div>
</div>
