<ion-header class="pagesHeader">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <h1><ion-icon name="grid" color="white"></ion-icon> C√©lulas</h1>
    </ion-title>
  </ion-toolbar>
</ion-header>

<style>
  .contenido {
    opacity: 0.5;
    transition: opacity 0.3s ease;
    pointer-events: none;
    /* evita que el texto interfiera con el hover */
  }

  .contenidoContacto {
    opacity: 0.0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    /* evita que el texto interfiera con el hover */
  }


  .subcontenido {
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    /* evita que el texto interfiera con el hover */
  }

  .hover-group:hover .contenido {
    opacity: 1;

  }

  .hover-group:hover .contenidoContacto {
    opacity: 1;

  }

  .hover-subgroup:hover .subcontenido {
    opacity: 1;

  }

  .zoomable {
    transition: all 0.3s ease;
  }

  /*.zoomable:hover {*/
  .hover-group:hover .zoomable {
    width: 240px;
    cursor: pointer !important;
    fill: #023f3c;
  }

  .hoverable {
    transition: all 0.3s ease;
  }

  /*.zoomable:hover {*/
  .hover-group:hover .hoverable {
    cursor: pointer !important;
    fill: #023f3c;
  }

  .expandible {
    transition: all 0.3s ease;
  }

  .expandible:hover {
    width: 240px;
    height: 240px;
    fill: #023f3c;
    cursor: pointer !important;
  }
</style>



<ion-content>



  <svg #svgRef class="org-svg">




    <g [attr.transform]="transform">

      <g class="hover-group" (click)="nivelSuperior(0)" *ngIf="baseNode.usuarioId != 0">
        <rect [attr.x]="baseNode.x - 80" [attr.y]="baseNode.y" width="30" height="30" fill="#4CAF50" rx="4" ry="4"
          class="hoverable" />
          <text [attr.x]="baseNode.x - 80 " [attr.y]="baseNode.y + 20" font-size="18" text-anchor="start"
          fill="white" class="contenido">üè†</text>
      </g>

      <g class="hover-group" (click)="nivelSuperior(baseNode.parentId)" *ngIf="baseNode.parentId > 0">
        <rect [attr.x]="baseNode.x - 40" [attr.y]="baseNode.y" width="30" height="30" fill="#4CAF50" rx="4" ry="4"
          class="hoverable" />
          <text [attr.x]="baseNode.x - 40" [attr.y]="baseNode.y + 20" font-size="18" text-anchor="start"
          fill="white" class="contenido">‚¨ÜÔ∏è</text>
      </g>

      <!-- Nodo principal -->
      <g class="hover-group" (click)="onRectClick(0)">
        <rect [attr.x]="baseNode.x" [attr.y]="baseNode.y" width="180" height="60" fill="#4CAF50" rx="4" ry="4"
          class="zoomable" />
        <text [attr.x]="baseNode.x + nodeTextLeftPadding" [attr.y]="baseNode.y + 25" font-size="18" text-anchor="start"
          fill="white" class="contenido">{{baseNode.nombre}}</text>
        <text [attr.x]="baseNode.x + nodeTextLeftPadding" [attr.y]="baseNode.y + 40" font-size="12" text-anchor="start"
          fill="white" class="contenidoContacto">{{baseNode.contacto}}</text>
      </g>

      <g class="hover-group" *ngFor="let node of precalculatedNodesReversed" (click)="onRectClick(node.usuarioId)">

        <rect [attr.x]="node.x" [attr.y]="node.y" width="180" height="60" fill="#4CAF50" rx="4" ry="4"
          class="zoomable" />
        <text [attr.x]="node.x + nodeTextLeftPadding" [attr.y]="node.y + 25" font-size="18" text-anchor="start"
          fill="white" class="contenido">{{node.nombre}}</text>
        <text [attr.x]="node.x + nodeTextLeftPadding" [attr.y]="node.y + 40" font-size="12" text-anchor="start"
          fill="white" class="contenidoContacto">{{node.contacto}}</text>
        <path *ngIf="node.parent && node.nivel == 0" [attr.d]="node.ruta" stroke-width="2" stroke="#444" fill="none" />
        <line *ngIf="node.parent && node.nivel == 1" [attr.x1]="node.x - 90" [attr.y1]="node.y + 30" [attr.x2]="node.x"
          [attr.y2]="node.y + 30" stroke="#444" stroke-width="2" />

        <ng-container *ngIf="node.nivel > 0 && node.children!.length > 0" >
          <!--sub children-->
          <g class="hover-subgroup">
            <rect [attr.x]="node.x + 160" [attr.y]="node.y + 70" width="20" height="20" fill="#4CAF50" rx="4" ry="4"
              class="expandible" />

            <text *ngFor="let ch of node.children; let i = index" [attr.x]="node.x + nodeTextLeftPadding + 160"
              [attr.y]="node.y + (25 * ( 1 + i)) + 70" font-size="14" text-anchor="start" fill="white"
              class="subcontenido">{{ch}}</text>


          </g>
        </ng-container>
      </g>


    </g>
  </svg>

</ion-content>